<!DOCTYPE html>
<html lang="rw">
<head>
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="title" content="RWANDAN CATHOLIC MUSICIAN">
    <meta name="description" content="IYI WEBSITE IDUFASHA KUBONA INDIRIMBO">
    <meta name="keywords" content="indirimbo, music, Rwanda, website">
    <meta name="author" content="Gaspard GASANGWA">
    <meta property="og:title" content="RWANDAN CATHOLIC">
    <meta property="og:description" content="Ibisobanuro bya website yawe">
    <meta property="og:image" content="https://GASPARD219.github.io/repository-name/logo.png">
    <meta property="og:url" content="https://GASPARD219.github.io/repository-name/">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RWANDAN CATHOLIC MUSICIAN">
    
    <title>INDIRIMBO ZA GATOLIKA</title>
    
    <style>
        /* ===== ORIGINAL STYLES - FULLY PRESERVED ===== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        #songCount {
            margin-top: 15px;
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
        }
        
        /* ===== LANGUAGE SWITCHER ===== */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 6px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            z-index: 200;
        }
        .lang-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        .lang-btn.active {
            background: white;
            color: #4b0082;
            border-color: white;
        }
        
        /* ===== SEARCH & FILTER ===== */
        .search-box {
            text-align: center;
            padding: 25px 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .search-box input {
            flex: 2;
            min-width: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-box select {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        .search-box button {
            padding: 15px 25px;
            background: #4b0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ===== SECTION NAVIGATION ===== */
        #sectionNav {
            background: linear-gradient(135deg, #6a5acd, #9370db);
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            position: sticky;
            top: 140px;
            z-index: 99;
        }
        #sectionNav button {
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 25px;
            font-weight: bold;
            transition: 0.3s;
            white-space: nowrap;
        }
        #sectionNav button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        #sectionNav button.active-section {
            background: #4b0082;
            border: 2px solid white;
        }
        
        /* ===== SECTIONS ===== */
        .section {
            display: none;
            padding: 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .section h2 {
            color: #4b0082;
            border-bottom: 3px solid #4b0082;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .songs-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }
        .song {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 6px solid #4b0082;
        }
        .song-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .song-title {
            color: #333;
            margin: 0;
            font-size: 22px;
            flex: 1;
        }
        .song-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .song-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .download-btn, .preview-btn, .sheet-music-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            gap: 8px;
            transition: 0.3s;
        }
        .download-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        .preview-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }
        .sheet-music-btn {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
        }
        .download-btn:hover, .preview-btn:hover, .sheet-music-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* ===== NO SONGS MESSAGE ===== */
        .no-songs-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 60px;
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            font-size: 18px;
        }
        .no-songs-message .icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #4b0082;
        }
        
        /* ===== IMPROVED SHEET MUSIC STYLES ===== */
        .sheet-music-display {
            background: #fff9f0;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .staff-container {
            background: white;
            padding: 30px 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
            overflow-x: auto;
            margin: 20px 0;
        }

        .staff-line {
            position: relative;
            height: 100px;
            background: linear-gradient(
                to bottom,
                transparent 0%,
                transparent 18%,
                #333 18%,
                #333 20%,
                transparent 20%,
                transparent 38%,
                #333 38%,
                #333 40%,
                transparent 40%,
                transparent 58%,
                #333 58%,
                #333 60%,
                transparent 60%,
                transparent 78%,
                #333 78%,
                #333 80%,
                transparent 80%,
                transparent 98%,
                #333 98%,
                #333 100%
            );
            margin: 10px 0;
            min-width: 200px;
        }

        .measure {
            display: inline-block;
            border-right: 2px solid #999;
            padding-right: 20px;
            margin-right: 20px;
            vertical-align: top;
            position: relative;
        }

        .measure:last-child {
            border-right: none;
        }

        .note-group {
            display: inline-block;
            position: relative;
            width: 60px;
            height: 100px;
            margin: 0 5px;
            vertical-align: top;
        }

        .note-head {
            position: absolute;
            width: 14px;
            height: 14px;
            background: black;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        .note-stem {
            position: absolute;
            width: 2px;
            height: 40px;
            background: black;
            left: 50%;
            transform: translateX(-50%);
        }

        .note-beam {
            position: absolute;
            width: 20px;
            height: 4px;
            background: black;
            left: 50%;
            transform: translateX(-50%);
        }

        .note-lyric {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            white-space: nowrap;
            color: #333;
            font-weight: bold;
        }

        .note-chord {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #8e44ad;
            font-weight: bold;
            white-space: nowrap;
        }

        .clef {
            font-size: 48px;
            display: inline-block;
            vertical-align: top;
            margin-right: 10px;
            color: #4b0082;
        }

        .time-signature {
            font-size: 24px;
            display: inline-block;
            vertical-align: top;
            margin-right: 20px;
            font-weight: bold;
        }

        /* Note positions on staff (0 = bottom line, 8 = top line) */
        .note-pos-0 { top: 78px; }  /* Bottom line */
        .note-pos-1 { top: 68px; }  /* Space below middle */
        .note-pos-2 { top: 58px; }  /* Middle line */
        .note-pos-3 { top: 48px; }  /* Space above middle */
        .note-pos-4 { top: 38px; }  /* Top line */
        .note-pos-5 { top: 28px; }  /* Above staff */
        .note-pos-6 { top: 18px; }  /* Higher */
        .note-pos-7 { top: 8px; }   /* Even higher */
        .note-pos-8 { top: -2px; }  /* Highest */

        .ledger-line {
            position: absolute;
            width: 20px;
            height: 2px;
            background: #333;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* ===== COMPACT BOTTOM SECTION ===== */
        .bottom-section {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px 15px;
            margin-top: 40px;
            text-align: center;
            border-top: 4px solid #4b0082;
        }
        .bottom-container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretch;
            gap: 20px;
        }
        .bottom-card {
            background: rgba(255,255,255,0.1);
            padding: 20px 25px;
            border-radius: 20px;
            flex: 1 1 250px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .bottom-card:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-5px);
        }
        .bottom-card h3 {
            color: #ffd700;
            margin: 0 0 10px 0;
            font-size: 20px;
            border-bottom: 2px solid #ffd700;
            display: inline-block;
            padding-bottom: 8px;
        }
        .bottom-card p {
            margin: 10px 0;
            font-size: 14px;
            color: #e0e0e0;
            line-height: 1.4;
        }
        .bottom-action-btn {
            background: #4b0082;
            color: white;
            border: none;
            padding: 10px 22px;
            border-radius: 40px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0 5px;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
        }
        .bottom-action-btn:hover {
            background: #5a0d9c;
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(0,0,0,0.25);
            border-color: white;
        }
        .bottom-card .small-info {
            font-size: 12px;
            color: #b0c4de;
            margin-top: 8px;
        }
        
        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 25px;
            width: 90%;
            max-width: 1200px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal-content h3 {
            color: #4b0082;
            margin-top: 0;
            border-bottom: 3px solid #6a5acd;
            padding-bottom: 12px;
        }
        .modal-content input, .modal-content select, .modal-content textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            box-sizing: border-box;
        }
        .send-btn {
            background: #4b0082;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
        }
        .close-btn {
            background: #6c757d;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* ===== ADMIN NOTIFICATION ===== */
        .admin-notification {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #ff4444;
            color: white;
            padding: 10px 18px;
            border-radius: 40px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 10002;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        /* ===== FILE PREVIEW ===== */
        .preview-iframe {
            width: 100%;
            height: 70vh;
            border: none;
            border-radius: 10px;
        }
        .preview-audio {
            width: 100%;
            margin-top: 20px;
        }
        .preview-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            .search-box { flex-direction: column; }
            #sectionNav { top: 200px; }
            .songs-list { grid-template-columns: 1fr; }
            .lang-switch { position: static; justify-content: center; margin-top: 10px; }
            .bottom-container { flex-direction: column; align-items: center; }
            .bottom-card { width: 100%; max-width: 300px; }
        }
    </style>
</head>
<body>

<!-- ===== ADMIN NOTIFICATION ===== -->
<div id="adminNotification" class="admin-notification">
    <span>üîî</span>
    <span id="notificationMessage">Hari user ukoze upload! Raba admin dashboard</span>
</div>

<!-- ===== LANGUAGE SWITCHER ===== -->
<div class="lang-switch" id="globalLangSwitch">
    <button class="lang-btn" data-lang="rw" onclick="setLanguage('rw')">Kinyarwanda</button>
    <button class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">Fran√ßais</button>
    <button class="lang-btn" data-lang="sw" onclick="setLanguage('sw')">Kiswahili</button>
    <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">English</button>
</div>

<!-- ===== HEADER ===== -->
<header>
    <h1 id="appTitle">INDIRIMBO ZA GATOLIKA</h1>
    <p id="songCount">SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA</p>
</header>

<!-- ===== SEARCH & FILTER ===== -->
<div class="search-box">
    <input type="text" id="searchInput" placeholder="Shaka indirimbo ku izina..." oninput="searchSongs()" autocomplete="off">
    <select id="sectionFilter" onchange="filterBySection()">
        <option value="">-- Shaka ukurikije igice --</option>
        <option>Gutangira</option>
        <option>Nyagasani Tubabarire</option>
        <option>Imana nisingizwe mu ijuru</option>
        <option>Zaburi</option>
        <option>Alleluya</option>
        <option>Indanga kwemera</option>
        <option>Ibisabisho</option>
        <option>Gutura</option>
        <option>Nyirubutagatifu</option>
        <option>Ntama w'Imana</option>
        <option>Gusangira</option>
        <option>Gushimira</option>
        <option>Gusoza</option>
        <option>Bikiramariya</option>
        <option>Abatagatifu bose</option>
        <option>Gushyingirwa</option>
        <option>Ibitaramo</option>
        <option>Adiventi</option>
        <option>Noheli</option>
        <option>Igisibo</option>
        <option>Pasika</option>
        <option>Asensiyo</option>
        <option>Rohomutagatifu</option>
        <option>Other More songs</option>
    </select>
    <button onclick="clearFilters()" id="resetBtn">Subira</button>
</div>

<!-- ===== SECTION NAVIGATION ===== -->
<nav id="sectionNav"></nav>

<!-- ===== SONGS CONTAINER ===== -->
<div id="sectionsContainer"></div>

<!-- ===== BOTTOM SECTION ===== -->
<div class="bottom-section">
    <div class="bottom-container">
        <div class="bottom-card">
            <h3 id="adminCardTitle">üîê Admin</h3>
            <p id="adminCardDesc">Injira nka admin ushyireho indirimbo</p>
            <button class="bottom-action-btn" onclick="window.location.href='admin.html'">
                <span>üîë</span> <span id="adminBtnText">Injira</span>
            </button>
            <div class="small-info">Ushobora gucunga indirimbo</div>
        </div>
        <div class="bottom-card">
            <h3 id="contactCardTitle">üìû Twandikire</h3>
            <p id="contactCardDesc">Ufite ikibazo? Ohereza ubutumwa</p>
            <button class="bottom-action-btn" onclick="showContactModal()">
                <span>‚úâÔ∏è</span> <span id="contactBtnText">Ohereza</span>
            </button>
            <div class="small-info" id="contactInfoText">üìß gaspardgasangwa76@gmail.com</div>
        </div>
        <div class="bottom-card">
            <h3 id="userUploadTitle">üéµ Shyiramo</h3>
            <p id="userUploadDesc">Shyiramo indirimbo yawe ihite igaragara</p>
            <button class="bottom-action-btn" onclick="showUserUploadModal()">
                <span>üì§</span> <span id="userUploadBtnText">Shyiramo</span>
            </button>
            <div class="small-info" id="userUploadHint">‚è±Ô∏è Ihita igaragara mu gice</div>
        </div>
    </div>
</div>

<!-- ===== CONTACT MODAL ===== -->
<div id="contactModal" class="modal">
    <div class="modal-content" style="max-width:500px;">
        <h3 id="modalTitle">Twandikire</h3>
        <input type="email" id="contactEmail" placeholder="Imeyili yawe">
        <textarea id="contactMessage" placeholder="Andika ubutumwa" rows="4"></textarea>
        <button class="send-btn" onclick="sendMessage()" id="sendBtn">Ohereza</button>
        <button class="close-btn" onclick="closeContactModal()" id="closeBtn">Funga</button>
    </div>
</div>

<!-- ===== USER UPLOAD MODAL ===== -->
<div id="userUploadModal" class="modal">
    <div class="modal-content" style="max-width:500px;">
        <h3 id="userUploadModalTitle">üì§ Shyiraho indirimbo</h3>
        <p id="userUploadModalDesc" style="color:#666;">Uzuza, ihite igaragara!</p>
        <input type="text" id="userSongTitle" placeholder="Izina ry'indirimbo">
        <select id="userSongSection">
            <option value="">-- Hitamo igice cya missa --</option>
            <option>Gutangira</option>
            <option>Nyagasani Tubabarire</option>
            <option>Imana nisingizwe mu ijuru</option>
            <option>Zaburi</option>
            <option>Alleluya</option>
            <option>Indanga kwemera</option>
            <option>Ibisabisho</option>
            <option>Gutura</option>
            <option>Nyirubutagatifu</option>
            <option>Ntama w'Imana</option>
            <option>Gusangira</option>
            <option>Gushimira</option>
            <option>Gusoza</option>
            <option>Bikiramariya</option>
            <option>Abatagatifu bose</option>
            <option>Gushyingirwa</option>
            <option>Ibitaramo</option>
            <option>Adiventi</option>
            <option>Noheli</option>
            <option>Igisibo</option>
            <option>Pasika</option>
            <option>Asensiyo</option>
            <option>Rohomutagatifu</option>
            <option>Other More songs</option>
        </select>
        <input type="file" id="userSongFile" accept=".mp3,.pdf,.jpg,.jpeg,.png,.gif">
        
        <!-- Sheet Music Input Section -->
        <div class="sheet-music-input" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h4 style="color: #4b0082; margin: 0 0 10px 0;">üéº Inoti z'indirimbo (Optional)</h4>
            <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                Andika inoti z'indirimbo ukoresheje:<br>
                <strong>Format:</strong> NOTE:LYRIC:CHORD (igitambambuga, umurongo, amagambo, chord)<br>
                <strong>Urugero:</strong> C:Men: , G:A-:men, Am:Mu-: , F:kama:<br>
                NOTE = C, D, E, F, G, A, B, C5, D5, etc.
            </p>
            <textarea id="sheetMusicTextarea" placeholder="Example:&#10;C:Men: , G:A-:men, Am:Mu-: , F:kama:&#10;C:U-: , G:mwi-: , C:ne: , F:I-: , G:ma-: , C:na:" rows="4" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;"></textarea>
        </div>
        
        <input type="email" id="userEmail" placeholder="Imeyili yawe">
        <textarea id="userComments" placeholder="Igitekerezo (byaba biri)" rows="2"></textarea>
        <div style="margin-top:20px;">
            <button class="send-btn" onclick="submitUserSong()" id="submitSongBtn">Ohereza</button>
            <button class="close-btn" onclick="closeUserUploadModal()" id="cancelUploadBtn">Gusiba</button>
        </div>
    </div>
</div>

<!-- ===== SHEET MUSIC PREVIEW MODAL ===== -->
<div id="sheetMusicModal" class="modal">
    <div class="modal-content" style="max-width: 1200px; background: #fffaf0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin:0; color:#4b0082;">üéµ Inoti z'indirimbo</h3>
            <button onclick="closeSheetMusicModal()" style="background:transparent; border:none; font-size:28px; cursor:pointer; color:#666;">&times;</button>
        </div>
        <div id="sheetMusicContainer" style="text-align: center; min-height: 400px;"></div>
        <div style="text-align: right; margin-top: 20px;">
            <button class="close-btn" onclick="closeSheetMusicModal()">Funga</button>
        </div>
    </div>
</div>

<!-- ===== FILE PREVIEW MODAL ===== -->
<div id="previewModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 id="previewTitle" style="margin:0; color:#4b0082;">üîç Reba indirimbo</h3>
            <button onclick="closePreviewModal()" style="background:transparent; border:none; font-size:28px; cursor:pointer; color:#666;">&times;</button>
        </div>
        <div id="previewContainer" style="text-align: center; min-height: 200px;"></div>
        <div style="text-align: right; margin-top: 20px;">
            <button class="close-btn" onclick="closePreviewModal()" id="closePreviewBtn">Funga</button>
        </div>
    </div>
</div>

<script>
    // ========== 4-LANGUAGE TRANSLATIONS ==========
    const translations = {
        rw: {
            appTitle: "INDIRIMBO ZA GATOLIKA",
            songCount: "SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA",
            searchPlaceholder: "Shaka indirimbo ku izina...",
            filterPlaceholder: "-- Shaka ukurikije igice --",
            reset: "Subira",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Injira nka admin ushyireho indirimbo",
            adminBtnText: "Injira",
            contactCardTitle: "üìû Twandikire",
            contactCardDesc: "Ufite ikibazo? Ohereza ubutumwa",
            contactBtnText: "Ohereza",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Twandikire",
            emailPlaceholder: "Imeyili yawe",
            messagePlaceholder: "Andika ubutumwa",
            send: "Ohereza",
            close: "Funga",
            messageSent: "Ubutumwa bwawe bwoherejwe! Murakoze.",
            userUploadTitle: "üéµ Shyiramo",
            userUploadDesc: "Shyiramo indirimbo yawe ihite igaragara",
            userUploadBtnText: "Shyiramo",
            userUploadHint: "‚è±Ô∏è Ihita igaragara mu gice",
            userModalTitle: "üì§ Shyiraho indirimbo",
            userModalDesc: "Uzuza, ihite igaragara!",
            songTitlePlaceholder: "Izina ry'indirimbo",
            sectionPlaceholder: "-- Hitamo igice cya missa --",
            emailPlaceholder2: "Imeyili yawe",
            commentsPlaceholder: "Igitekerezo (byaba biri)",
            submitBtn: "Ohereza",
            cancelBtn: "Gusiba",
            submitSuccess: "Indirimbo yawe yashyizweho! Igaragara noneho.",
            fileRequired: "Hitamo fayilo!",
            titleRequired: "Andika izina ry'indirimbo!",
            sectionRequired: "Hitamo igice!",
            emailRequired: "Andika imeyili yawe!",
            previewTitle: "üîç Reba indirimbo",
            closePreview: "Funga",
            adminNotification: "üîî Hari user ukoze upload!",
            download: "Kumanura",
            preview: "Reba",
            sheetMusic: "Inoti",
            noSongsTitle: "Nta ndirimbo zihari",
            noSongsMessage: "Nta ndirimbo zirimo muri iki gice. Shyiramo bwa mbere!"
        },
        fr: {
            appTitle: "CHANTS CATHOLIQUES",
            songCount: "RECHERCHER UN CHANT PAR NOM OU SECTION",
            searchPlaceholder: "Rechercher un chant...",
            filterPlaceholder: "-- Filtrer par section --",
            reset: "R√©initialiser",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Connectez-vous en tant qu'admin",
            adminBtnText: "Connexion",
            contactCardTitle: "üìû Contact",
            contactCardDesc: "Des questions? Envoyez-nous un message",
            contactBtnText: "Envoyer",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Contactez-nous",
            emailPlaceholder: "Votre email",
            messagePlaceholder: "Votre message",
            send: "Envoyer",
            close: "Fermer",
            messageSent: "Message envoy√©! Merci.",
            userUploadTitle: "üéµ Ajouter",
            userUploadDesc: "Ajoutez votre chant, il appara√Æt instantan√©ment",
            userUploadBtnText: "Ajouter",
            userUploadHint: "‚è±Ô∏è Appara√Æt dans la section choisie",
            userModalTitle: "üì§ Ajouter un chant",
            userModalDesc: "Remplissez, appara√Æt instantan√©ment!",
            songTitlePlaceholder: "Titre du chant",
            sectionPlaceholder: "-- Choisissez la section --",
            emailPlaceholder2: "Votre email",
            commentsPlaceholder: "Commentaire (optionnel)",
            submitBtn: "Soumettre",
            cancelBtn: "Annuler",
            submitSuccess: "Votre chant a √©t√© ajout√©! Il est visible maintenant.",
            fileRequired: "Choisissez un fichier!",
            titleRequired: "Entrez le titre!",
            sectionRequired: "Choisissez la section!",
            emailRequired: "Entrez votre email!",
            previewTitle: "üîç Aper√ßu",
            closePreview: "Fermer",
            adminNotification: "üîî Un utilisateur a ajout√© un chant!",
            download: "T√©l√©charger",
            preview: "Aper√ßu",
            sheetMusic: "Partition",
            noSongsTitle: "Aucun chant",
            noSongsMessage: "Aucun chant dans cette section. Soyez le premier √† ajouter!"
        }
    };

    // ========== GLOBAL VARIABLES ==========
    let currentLang = localStorage.getItem('preferredLang') || 'rw';
    let allSongs = [];
    let sheetMusicData = {};

    // Note to position mapping (where 0 is bottom line, 8 is top line)
    const notePositions = {
        'C': 0, 'C#': 0, 'Db': 0,
        'D': 1, 'D#': 1, 'Eb': 1,
        'E': 2,
        'F': 2.5, 'F#': 2.5, 'Gb': 2.5,
        'G': 3, 'G#': 3, 'Ab': 3,
        'A': 4, 'A#': 4, 'Bb': 4,
        'B': 5,
        'C5': 5.5,
        'D5': 6.5,
        'E5': 7.5,
        'F5': 8
    };

    // Load sheet music data
    function loadSheetMusicData() {
        const saved = localStorage.getItem('sheetMusicData');
        if (saved) {
            try {
                sheetMusicData = JSON.parse(saved);
            } catch (e) {
                sheetMusicData = {};
            }
        }
    }

    // Save sheet music data
    function saveSheetMusicData() {
        localStorage.setItem('sheetMusicData', JSON.stringify(sheetMusicData));
    }

    // ========== LANGUAGE FUNCTIONS ==========
    window.setLanguage = function(lang) {
        currentLang = lang;
        localStorage.setItem('preferredLang', lang);
        applyTranslations();
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === lang);
        });
    };

    function applyTranslations() {
        const t = translations[currentLang];
        document.getElementById('appTitle').innerText = t.appTitle;
        document.getElementById('songCount').innerHTML = t.songCount;
        document.getElementById('searchInput').placeholder = t.searchPlaceholder;
        document.getElementById('sectionFilter').options[0].text = t.filterPlaceholder;
        document.getElementById('resetBtn').innerText = t.reset;
        document.getElementById('adminCardTitle').innerHTML = t.adminCardTitle;
        document.getElementById('adminCardDesc').innerText = t.adminCardDesc;
        document.getElementById('adminBtnText').innerText = t.adminBtnText;
        document.getElementById('contactCardTitle').innerHTML = t.contactCardTitle;
        document.getElementById('contactCardDesc').innerText = t.contactCardDesc;
        document.getElementById('contactBtnText').innerText = t.contactBtnText;
        document.getElementById('contactInfoText').innerHTML = t.contactInfo;
        document.getElementById('modalTitle').innerText = t.modalTitle;
        document.getElementById('contactEmail').placeholder = t.emailPlaceholder;
        document.getElementById('contactMessage').placeholder = t.messagePlaceholder;
        document.getElementById('sendBtn').innerText = t.send;
        document.getElementById('closeBtn').innerText = t.close;
        document.getElementById('userUploadTitle').innerHTML = t.userUploadTitle;
        document.getElementById('userUploadDesc').innerText = t.userUploadDesc;
        document.getElementById('userUploadBtnText').innerText = t.userUploadBtnText;
        document.getElementById('userUploadHint').innerHTML = t.userUploadHint;
        document.getElementById('userUploadModalTitle').innerText = t.userModalTitle;
        document.getElementById('userUploadModalDesc').innerText = t.userModalDesc;
        document.getElementById('userSongTitle').placeholder = t.songTitlePlaceholder;
        document.getElementById('userSongSection').options[0].text = t.sectionPlaceholder;
        document.getElementById('userEmail').placeholder = t.emailPlaceholder2;
        document.getElementById('userComments').placeholder = t.commentsPlaceholder;
        document.getElementById('submitSongBtn').innerText = t.submitBtn;
        document.getElementById('cancelUploadBtn').innerText = t.cancelBtn;
        document.getElementById('previewTitle').innerText = t.previewTitle;
        document.getElementById('closePreviewBtn').innerText = t.closePreview;
        document.getElementById('notificationMessage').innerText = t.adminNotification;
    }

    // ========== SHEET MUSIC FUNCTIONS ==========
    function parseSheetMusic(text) {
        if (!text || text.trim() === '') return [];
        
        const lines = text.split('\n');
        const measures = [];
        
        lines.forEach(line => {
            if (line.trim() === '') return;
            
            // Split by comma to get individual notes
            const notes = line.split(',').map(n => n.trim()).filter(n => n.length > 0);
            const measureNotes = [];
            
            notes.forEach(note => {
                // Format: NOTE:LYRIC:CHORD
                const parts = note.split(':');
                if (parts.length >= 1) {
                    measureNotes.push({
                        note: parts[0] || 'C',
                        lyric: parts[1] || '',
                        chord: parts[2] || ''
                    });
                }
            });
            
            if (measureNotes.length > 0) {
                measures.push(measureNotes);
            }
        });
        
        return measures;
    }

    function renderMusicalNote(noteData, index) {
        const note = noteData.note || 'C';
        const lyric = noteData.lyric || '';
        const chord = noteData.chord || '';
        
        // Get position (0-8) or default to 2
        let position = notePositions[note];
        if (position === undefined) position = 2;
        
        // Round to nearest 0.5 for display
        position = Math.round(position * 2) / 2;
        const posClass = `note-pos-${Math.floor(position)}`;
        
        let ledgerLine = '';
        // Add ledger line if note is above or below staff
        if (position < 0 || position > 4) {
            ledgerLine = '<div class="ledger-line"></div>';
        }
        
        // Determine if stem goes up or down
        const stemUp = position < 2.5;
        
        return `
            <div class="note-group">
                <div class="note-head ${posClass}"></div>
                <div class="note-stem" style="top: ${stemUp ? '20px' : '10px'}; height: 40px;"></div>
                ${ledgerLine}
                <div class="note-chord">${chord}</div>
                <div class="note-lyric">${lyric}</div>
            </div>
        `;
    }

    function renderSheetMusic(songId, songTitle) {
        const songData = sheetMusicData[songId];
        const t = translations[currentLang];
        
        if (!songData || !songData.measures || songData.measures.length === 0) {
            // Create sample for demo if none exists
            if (songId === 'sample-2') {
                const sampleMeasures = [
                    [{note: 'C', lyric: 'A-', chord: 'C'}, {note: 'G', lyric: 'men', chord: 'G'}, {note: 'Am', lyric: 'Mu-', chord: 'Am'}, {note: 'F', lyric: 'kama', chord: 'F'}],
                    [{note: 'C', lyric: 'U-', chord: 'C'}, {note: 'G', lyric: 'mwi-', chord: 'G'}, {note: 'C', lyric: 'ne', chord: 'C'}, {note: 'F', lyric: 'I-', chord: 'F'}, {note: 'G', lyric: 'ma-', chord: 'G'}, {note: 'C', lyric: 'na', chord: 'C'}]
                ];
                songData.measures = sampleMeasures;
            } else {
                return `
                    <div class="sheet-music-display">
                        <h4 style="color: #4b0082; margin-bottom: 20px;">${songTitle}</h4>
                        <div class="music-note">üéº</div>
                        <p style="color: #666; margin: 20px 0;">Nta noti z'indirimbo zihari</p>
                        <p style="font-size: 14px; color: #999;">
                            Ushobora kongeramo inoti mu gihe ushyiraho indirimbo
                        </p>
                    </div>
                `;
            }
        }

        let measuresHtml = '';
        songData.measures.forEach((measure, mIndex) => {
            let notesHtml = '';
            measure.forEach((note, nIndex) => {
                notesHtml += renderMusicalNote(note, nIndex);
            });
            
            measuresHtml += `
                <div class="measure">
                    ${notesHtml}
                </div>
            `;
        });

        return `
            <div class="sheet-music-display">
                <h4 style="color: #4b0082; margin-bottom: 20px;">${songTitle}</h4>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <span class="clef">ùÑû</span>
                    <span class="time-signature">4/4</span>
                </div>
                <div class="staff-container">
                    <div class="staff-line">
                        ${measuresHtml}
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="downloadSheetMusic('${songId}')" class="bottom-action-btn">
                        ‚¨áÔ∏è ${t.download} Sheet Music
                    </button>
                </div>
            </div>
        `;
    }

    window.showSheetMusic = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        if (!song) return;

        const container = document.getElementById('sheetMusicContainer');
        container.innerHTML = renderSheetMusic(songId, song.title);
        
        document.getElementById('sheetMusicModal').style.display = 'flex';
    };

    window.closeSheetMusicModal = function() {
        document.getElementById('sheetMusicModal').style.display = 'none';
    };

    window.downloadSheetMusic = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        const songData = sheetMusicData[songId];
        
        if (!song) return;

        let content = `Title: ${song.title}\n`;
        content += `Section: ${song.section}\n`;
        content += `Date: ${new Date().toLocaleDateString()}\n`;
        content += `\n--- Sheet Music (NOTE:LYRIC:CHORD format) ---\n\n`;
        
        if (songData && songData.rawText) {
            content += songData.rawText;
        } else {
            content += 'C:A-:C, G:men:G, Am:Mu-:Am, F:kama:F\n';
            content += 'C:U-:C, G:mwi-:G, C:ne:C, F:I-:F, G:ma-:G, C:na:C';
        }

        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${song.title.replace(/\s+/g, '_')}_sheet_music.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };

    // ========== LOAD AND DISPLAY SONGS ==========
    function loadSongs() {
        allSongs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
        loadSheetMusicData();
        displayAllSongs();
        updateSongCount();
    }

    function displayAllSongs() {
        const container = document.getElementById('sectionsContainer');
        if (!container) return;
        
        const sections = {};
        allSongs.forEach(song => {
            if (!sections[song.section]) sections[song.section] = [];
            sections[song.section].push(song);
        });
        
        const allSections = [
            'Gutangira', 'Nyagasani Tubabarire', 'Imana nisingizwe mu ijuru',
            'Zaburi', 'Alleluya', 'Indanga kwemera', 'Ibisabisho', 'Gutura',
            'Nyirubutagatifu', 'Ntama w\'Imana', 'Gusangira', 'Gushimira',
            'Gusoza', 'Bikiramariya', 'Abatagatifu bose', 'Gushyingirwa',
            'Ibitaramo', 'Adiventi', 'Noheli', 'Igisibo', 'Pasika', 'Asensiyo',
            'Rohomutagatifu', 'Other More songs'
        ];
        
        let html = '';
        allSections.forEach(sectionName => {
            const sectionSongs = sections[sectionName] || [];
            html += `<div class="section" id="section-${sectionName.replace(/\s+/g, '-')}">`;
            html += `<h2>${sectionName} <span style="font-size: 18px; color: #666;">(${sectionSongs.length})</span></h2>`;
            
            if (sectionSongs.length === 0) {
                html += `<div class="no-songs-message">
                    <div class="icon">üéµ</div>
                    <p><strong>${translations[currentLang].noSongsTitle}</strong></p>
                    <p>${translations[currentLang].noSongsMessage}</p>
                </div>`;
            } else {
                html += `<div class="songs-list">`;
                sectionSongs.forEach(song => {
                    const hasSheetMusic = sheetMusicData[song.id] ? true : false;
                    
                    html += `<div class="song" id="song-${song.id}">`;
                    html += `<div class="song-header">`;
                    html += `<h3 class="song-title">${song.title}</h3>`;
                    html += `<span class="song-date">${song.dateAdded || ''}</span>`;
                    html += `</div>`;
                    html += `<div class="song-meta">`;
                    html += `<span class="song-section">${song.section}</span>`;
                    html += `<span class="song-size">${song.fileSize || ''}</span>`;
                    html += `<span class="download-count">üîΩ ${song.downloadCount || 0}</span>`;
                    if (hasSheetMusic) {
                        html += `<span style="background: #8e44ad; color: white; padding: 3px 10px; border-radius: 12px; font-size: 12px;">üéº Inoti</span>`;
                    }
                    if (song.uploadedBy === 'user') {
                        html += `<span style="background: #ffc107; color: #000; padding: 3px 10px; border-radius: 12px; font-size: 12px;">üë§ User</span>`;
                    }
                    html += `</div>`;
                    html += `<div class="song-actions">`;
                    
                    // Always show sheet music button
                    html += `<button class="sheet-music-btn" onclick="showSheetMusic('${song.id}')"><span>üéº</span> ${translations[currentLang].sheetMusic}</button>`;
                    
                    // Show preview for files
                    const fileExt = song.fileName ? song.fileName.split('.').pop().toLowerCase() : '';
                    if (['pdf', 'jpg', 'jpeg', 'png', 'gif', 'mp3'].includes(fileExt)) {
                        html += `<button class="preview-btn" onclick="previewFile('${song.id}')"><span>üëÅÔ∏è</span> ${translations[currentLang].preview}</button>`;
                    }
                    
                    html += `<button class="download-btn" onclick="downloadSong('${song.id}')"><span>‚¨áÔ∏è</span> ${translations[currentLang].download}</button>`;
                    html += `</div>`;
                    html += `</div>`;
                });
                html += `</div>`;
            }
            html += `</div>`;
        });
        
        container.innerHTML = html;
        if (allSections.length > 0) showSection(allSections[0]);
    }

    // ========== SECTION NAVIGATION ==========
    function createNavigation() {
        const sections = [
            'Gutangira', 'Nyagasani Tubabarire', 'Imana nisingizwe mu ijuru',
            'Zaburi', 'Alleluya', 'Indanga kwemera', 'Ibisabisho', 'Gutura',
            'Nyirubutagatifu', 'Ntama w\'Imana', 'Gusangira', 'Gushimira',
            'Gusoza', 'Bikiramariya', 'Abatagatifu bose', 'Gushyingirwa',
            'Ibitaramo', 'Adiventi', 'Noheli', 'Igisibo', 'Pasika', 'Asensiyo',
            'Rohomutagatifu', 'Other More songs'
        ];
        const nav = document.getElementById('sectionNav');
        if (!nav) return;
        nav.innerHTML = '';
        sections.forEach(section => {
            const btn = document.createElement('button');
            btn.textContent = section;
            btn.setAttribute('data-section', section);
            btn.onclick = function(e) {
                document.querySelectorAll('#sectionNav button').forEach(b => b.classList.remove('active-section'));
                e.currentTarget.classList.add('active-section');
                showSection(section);
            };
            nav.appendChild(btn);
        });
    }

    function showSection(sectionName) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        const section = document.getElementById(`section-${sectionName.replace(/\s+/g, '-')}`);
        if (section) section.classList.add('active');
    }

    // ========== PREVIEW FILE ==========
    window.previewFile = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        if (!song) { alert("Indirimbo ntabwo iboneka!"); return; }
        
        const container = document.getElementById('previewContainer');
        container.innerHTML = '';
        
        const titleEl = document.createElement('h4');
        titleEl.style.marginBottom = '20px';
        titleEl.style.color = '#4b0082';
        titleEl.style.fontSize = '20px';
        titleEl.textContent = song.title;
        container.appendChild(titleEl);
        
        const fileExt = song.fileName ? song.fileName.split('.').pop().toLowerCase() : '';
        const fileUrl = song.fileUrl;
        
        if (fileExt === 'mp3') {
            const audio = document.createElement('audio');
            audio.controls = true;
            audio.style.width = '100%';
            const source = document.createElement('source');
            source.src = fileUrl;
            source.type = 'audio/mpeg';
            audio.appendChild(source);
            container.appendChild(audio);
        } else if (fileExt === 'pdf') {
            const iframe = document.createElement('iframe');
            iframe.src = fileUrl;
            iframe.style.width = '100%';
            iframe.style.height = '70vh';
            iframe.style.border = 'none';
            container.appendChild(iframe);
        } else if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExt)) {
            const img = document.createElement('img');
            img.src = fileUrl;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '70vh';
            img.style.borderRadius = '10px';
            container.appendChild(img);
        } else {
            container.innerHTML += `
                <div style="padding:40px; background:#f8f9fa; border-radius:10px;">
                    <p>Ntago ushobora kureba iyi fayilo muri browser.</p>
                    <button onclick="downloadSong('${song.id}'); closePreviewModal();" 
                            style="background:#4CAF50; color:white; border:none; padding:12px 30px; border-radius:50px; margin-top:20px; cursor:pointer;">
                        ‚¨áÔ∏è ${translations[currentLang].download}
                    </button>
                </div>
            `;
        }
        document.getElementById('previewModal').style.display = 'flex';
    };

    window.closePreviewModal = function() {
        document.getElementById('previewModal').style.display = 'none';
        document.getElementById('previewContainer').innerHTML = '';
    };

    // ========== DOWNLOAD SONG ==========
    window.downloadSong = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        if (!song) { alert("Indirimbo ntabwo iboneka!"); return; }
        
        song.downloadCount = (song.downloadCount || 0) + 1;
        localStorage.setItem('catholicSongs', JSON.stringify(allSongs));
        
        const a = document.createElement('a');
        a.href = song.fileUrl;
        a.download = song.fileName || `${song.title}.${song.fileType || 'mp3'}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        displayAllSongs();
    };

    // ========== USER SUBMIT SONG ==========
    window.submitUserSong = function() {
        const t = translations[currentLang];
        const title = document.getElementById('userSongTitle').value.trim();
        const section = document.getElementById('userSongSection').value;
        const file = document.getElementById('userSongFile').files[0];
        const email = document.getElementById('userEmail').value.trim();
        const sheetMusicText = document.getElementById('sheetMusicTextarea').value.trim();
        
        if (!title) { alert(t.titleRequired); return; }
        if (!section) { alert(t.sectionRequired); return; }
        if (!file) { alert(t.fileRequired); return; }
        if (!email) { alert(t.emailRequired); return; }
        
        const fileUrl = URL.createObjectURL(file);
        const songId = 'song-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        
        const newSong = {
            id: songId,
            title: title,
            section: section,
            fileUrl: fileUrl,
            fileName: file.name,
            fileType: file.name.split('.').pop().toLowerCase(),
            fileSize: (file.size / 1024).toFixed(2) + ' KB',
            dateAdded: new Date().toLocaleDateString('rw-RW'),
            downloadCount: 0,
            uploadedBy: 'user',
            uploaderEmail: email,
            comments: document.getElementById('userComments').value,
            submittedAt: new Date().toISOString()
        };
        
        allSongs.push(newSong);
        localStorage.setItem('catholicSongs', JSON.stringify(allSongs));
        
        // Save sheet music if provided
        if (sheetMusicText) {
            sheetMusicData[songId] = {
                rawText: sheetMusicText,
                measures: parseSheetMusic(sheetMusicText),
                created: new Date().toISOString()
            };
            saveSheetMusicData();
        }
        
        document.getElementById('adminNotification').style.display = 'flex';
        setTimeout(() => { document.getElementById('adminNotification').style.display = 'none'; }, 5000);
        
        alert(t.submitSuccess);
        closeUserUploadModal();
        displayAllSongs();
        showSection(section);
    };

    // ========== MODAL CONTROLS ==========
    window.showContactModal = function() {
        document.getElementById('contactModal').style.display = 'flex';
    };
    
    window.closeContactModal = function() {
        document.getElementById('contactModal').style.display = 'none';
        document.getElementById('contactEmail').value = '';
        document.getElementById('contactMessage').value = '';
    };
    
    window.sendMessage = function() {
        const email = document.getElementById('contactEmail').value.trim();
        const message = document.getElementById('contactMessage').value.trim();
        if (!email || !message) { alert(translations[currentLang].emailPlaceholder); return; }
        const msgs = JSON.parse(localStorage.getItem('contactMessages') || '[]');
        msgs.push({ email, message, time: new Date().toLocaleString() });
        localStorage.setItem('contactMessages', JSON.stringify(msgs));
        alert(translations[currentLang].messageSent);
        closeContactModal();
    };

    window.showUserUploadModal = function() {
        document.getElementById('userUploadModal').style.display = 'flex';
    };
    
    window.closeUserUploadModal = function() {
        document.getElementById('userUploadModal').style.display = 'none';
        document.getElementById('userSongTitle').value = '';
        document.getElementById('userSongSection').value = '';
        document.getElementById('userSongFile').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('userComments').value = '';
        document.getElementById('sheetMusicTextarea').value = '';
    };

    // ========== SEARCH & FILTER ==========
    window.searchSongs = function() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        if (!term) { displayAllSongs(); return; }
        
        const filtered = allSongs.filter(s => s.title.toLowerCase().includes(term) || s.section.toLowerCase().includes(term));
        const container = document.getElementById('sectionsContainer');
        if (filtered.length === 0) {
            container.innerHTML = `<div class="section active"><h2>Ubushakashatsi: "${term}"</h2><div class="no-songs-message"><div class="icon">üîç</div><p><strong>Nta ndirimbo zihuye</strong></p></div></div>`;
        } else {
            let html = `<div class="section active"><h2>Ubushakashatsi: "${term}" (${filtered.length})</h2><div class="songs-list">`;
            filtered.forEach(song => {
                html += `<div class="song"><div class="song-header"><h3 class="song-title">${song.title}</h3></div>
                    <div class="song-meta"><span>${song.section}</span><span>${song.fileSize || ''}</span><span>üîΩ ${song.downloadCount || 0}</span></div>
                    <div class="song-actions">
                        <button class="sheet-music-btn" onclick="showSheetMusic('${song.id}')">üéº ${translations[currentLang].sheetMusic}</button>
                        <button class="preview-btn" onclick="previewFile('${song.id}')">üëÅÔ∏è ${translations[currentLang].preview}</button>
                        <button class="download-btn" onclick="downloadSong('${song.id}')">‚¨áÔ∏è ${translations[currentLang].download}</button>
                    </div></div>`;
            });
            html += `</div></div>`;
            container.innerHTML = html;
        }
    };

    window.filterBySection = function() {
        const section = document.getElementById('sectionFilter').value;
        if (!section) { displayAllSongs(); return; }
        showSection(section);
        document.getElementById('sectionFilter').value = section;
    };

    window.clearFilters = function() {
        document.getElementById('searchInput').value = '';
        document.getElementById('sectionFilter').value = '';
        displayAllSongs();
    };

    function updateSongCount() {
        const el = document.getElementById('songCount');
        if (el) {
            let text = `${translations[currentLang].songCount} | Indirimbo: ${allSongs.length}`;
            if (Object.keys(sheetMusicData).length > 0) {
                text += ` | Inoti: ${Object.keys(sheetMusicData).length}`;
            }
            el.innerHTML = text;
        }
    }

    // ========== INITIALIZATION ==========
    window.onload = function() {
        // Sample songs with working URLs
        if (!localStorage.getItem('catholicSongs')) {
            const sampleSongs = [
                { 
                    id: 'sample-1', 
                    title: 'Imana nisingizwe mu ijuru (Audio)', 
                    section: 'Imana nisingizwe mu ijuru', 
                    fileUrl: 'https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3', 
                    fileName: 'sample.mp3', 
                    fileType: 'mp3', 
                    fileSize: '512 KB', 
                    dateAdded: '12/02/2026', 
                    downloadCount: 5, 
                    uploadedBy: 'admin' 
                },
                { 
                    id: 'sample-2', 
                    title: 'Zaburi ya 23 - Sheet Music', 
                    section: 'Zaburi', 
                    fileUrl: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf', 
                    fileName: 'zaburi.pdf', 
                    fileType: 'pdf', 
                    fileSize: '45 KB', 
                    dateAdded: '12/02/2026', 
                    downloadCount: 3, 
                    uploadedBy: 'admin' 
                }
            ];
            localStorage.setItem('catholicSongs', JSON.stringify(sampleSongs));
            
            // Add sample sheet music
            const sampleSheetMusic = {
                'sample-2': {
                    rawText: 'C:A-:C, G:men:G, Am:Mu-:Am, F:kama:F\nC:U-:C, G:mwi-:G, C:ne:C, F:I-:F, G:ma-:G, C:na:C',
                    measures: [
                        [{note: 'C', lyric: 'A-', chord: 'C'}, {note: 'G', lyric: 'men', chord: 'G'}, {note: 'Am', lyric: 'Mu-', chord: 'Am'}, {note: 'F', lyric: 'kama', chord: 'F'}],
                        [{note: 'C', lyric: 'U-', chord: 'C'}, {note: 'G', lyric: 'mwi-', chord: 'G'}, {note: 'C', lyric: 'ne', chord: 'C'}, {note: 'F', lyric: 'I-', chord: 'F'}, {note: 'G', lyric: 'ma-', chord: 'G'}, {note: 'C', lyric: 'na', chord: 'C'}]
                    ],
                    created: new Date().toISOString()
                }
            };
            localStorage.setItem('sheetMusicData', JSON.stringify(sampleSheetMusic));
        }
        
        loadSongs();
        createNavigation();
        applyTranslations();
        
        // Set active language button
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === currentLang);
        });
        
        setTimeout(() => {
            const firstBtn = document.querySelector('#sectionNav button');
            if (firstBtn) firstBtn.classList.add('active-section');
        }, 100);
    };
</script>
</body>
</html>
