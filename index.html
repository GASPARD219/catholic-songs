<!DOCTYPE html>
<html lang="rw">
<head>
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="title" content="RWANDAN CATHOLIC MUSICIAN">
    <meta name="description" content="IYI WEBSITE IDUFASHA KUBONA INDIRIMBO">
    <meta name="keywords" content="indirimbo, music, Rwanda, website">
    <meta name="author" content="Gaspard GASANGWA">
    <meta property="og:title" content="RWANDAN CATHOLIC">
    <meta property="og:description" content="Ibisobanuro bya website yawe">
    <meta property="og:image" content="https://GASPARD219.github.io/repository-name/logo.png">
    <meta property="og:url" content="https://GASPARD219.github.io/repository-name/">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RWANDAN CATHOLIC MUSICIAN">
    
    <title>INDIRIMBO ZA GATOLIKA</title>
    
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#4b0082">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icons/icon-192.png">
    
    <style>
        /* ===== ORIGINAL STYLES - FULLY PRESERVED ===== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        #songCount {
            margin-top: 15px;
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
        }
        
        /* ===== LANGUAGE SWITCHER ===== */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 6px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            z-index: 200;
        }
        .lang-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .lang-btn.active {
            background: white;
            color: #4b0082;
            border-color: white;
        }
        
        /* ===== SEARCH & NAVIGATION ===== */
        .search-box {
            text-align: center;
            padding: 25px 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .search-box input {
            flex: 2;
            min-width: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-box select {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        .search-box button {
            padding: 15px 25px;
            background: #4b0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        #sectionNav {
            background: linear-gradient(135deg, #6a5acd, #9370db);
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            position: sticky;
            top: 140px;
            z-index: 99;
        }
        #sectionNav button {
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 25px;
            font-weight: bold;
            transition: 0.3s;
            white-space: nowrap;
        }
        #sectionNav button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        .section {
            display: none;
            padding: 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .section h2 {
            color: #4b0082;
            border-bottom: 3px solid #4b0082;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .songs-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }
        .song {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 6px solid #4b0082;
        }
        .song-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .song-title {
            color: #333;
            margin: 0;
            font-size: 22px;
            flex: 1;
        }
        .song-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .song-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .download-btn, .play-btn, .preview-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            gap: 8px;
            transition: 0.3s;
        }
        .download-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        .play-btn, .preview-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }
        .no-songs {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 60px;
            grid-column: 1 / -1;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== COMPACT BOTTOM SECTION - REDUCED SIZE ===== */
        .bottom-admin-section {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 15px;
            margin-top: 40px;
            text-align: center;
            border-top: 4px solid #4b0082;
        }
        .bottom-admin-container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .admin-card, .contact-card, .user-upload-card {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 16px;
            flex: 0 1 auto;
            min-width: 200px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: 0.2s;
        }
        .admin-card:hover, .contact-card:hover, .user-upload-card:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        .admin-card h3, .contact-card h3, .user-upload-card h3 {
            color: #ffd700;
            margin: 0 0 8px 0;
            font-size: 18px;
            border-bottom: 2px solid #ffd700;
            display: inline-block;
            padding-bottom: 5px;
            font-weight: 600;
        }
        .bottom-btn {
            background: #4b0082;
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px 0;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid transparent;
        }
        .bottom-btn:hover {
            background: #5a0d9c;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.2);
            border-color: white;
        }
        .contact-info {
            text-align: center;
            margin-top: 6px;
            color: #ecf0f1;
            line-height: 1.5;
            font-size: 12px;
        }
        .admin-card p, .contact-card p, .user-upload-card p {
            margin: 5px 0;
            font-size: 13px;
            color: #e0e0e0;
        }
        
        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-content h3 {
            color: #4b0082;
            margin-top: 0;
            border-bottom: 3px solid #6a5acd;
            padding-bottom: 12px;
        }
        .modal-content input, .modal-content select, .modal-content textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            box-sizing: border-box;
        }
        .send-btn {
            background: #4b0082;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
        }
        .close-btn {
            background: #6c757d;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* ===== ADMIN NOTIFICATION BADGE ===== */
        .admin-notification {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #ff4444;
            color: white;
            padding: 10px 18px;
            border-radius: 40px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 10002;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        /* ===== FILE PREVIEW IFRAME ===== */
        .preview-iframe {
            width: 100%;
            height: 380px;
            border: none;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            .search-box { flex-direction: column; }
            #sectionNav { top: 200px; }
            .songs-list { grid-template-columns: 1fr; }
            .lang-switch { position: static; justify-content: center; margin-top: 10px; }
            .bottom-admin-container { flex-direction: column; }
            .admin-card, .contact-card, .user-upload-card { width: 100%; }
        }
    </style>
</head>
<body>

<!-- ===== ADMIN NOTIFICATION - SHOWS WHEN USER UPLOADS ===== -->
<div id="adminNotification" class="admin-notification">
    <span>üîî</span>
    <span id="notificationMessage">Hari user ukoze upload! Raba admin dashboard</span>
</div>

<!-- ===== LANGUAGE SWITCHER ===== -->
<div class="lang-switch" id="globalLangSwitch">
    <button class="lang-btn" data-lang="rw" onclick="setLanguage('rw')">Kinyarwanda</button>
    <button class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">Fran√ßais</button>
    <button class="lang-btn" data-lang="sw" onclick="setLanguage('sw')">Kiswahili</button>
    <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">English</button>
</div>

<!-- ===== HEADER ===== -->
<header>
    <h1 id="appTitle">INDIRIMBO ZA GATOLIKA</h1>
    <p id="songCount">SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA</p>
</header>

<!-- ===== SEARCH & FILTER ===== -->
<div class="search-box">
    <input type="text" id="searchInput" placeholder="Shaka indirimbo ku izina..." oninput="searchSongs()" autocomplete="off">
    <select id="sectionFilter" onchange="filterBySection()">
        <option value="">-- Shaka ukurikije igice --</option>
        <option>Gutangira</option>
        <option>Nyagasani Tubabarire</option>
        <option>Imana nisingizwe mu ijuru</option>
        <option>Zaburi</option>
        <option>Alleluya</option>
        <option>Indanga kwemera</option>
        <option>Ibisabisho</option>
        <option>Gutura</option>
        <option>Nyirubutagatifu</option>
        <option>Ntama w'Imana</option>
        <option>Gusangira</option>
        <option>Gushimira</option>
        <option>Gusoza</option>
        <option>Bikiramariya</option>
        <option>Abatagatifu bose</option>
        <option>Gushyingirwa</option>
        <option>Ibitaramo</option>
        <option>Adiventi</option>
        <option>Noheli</option>
        <option>Igisibo</option>
        <option>Pasika</option>
        <option>Asensiyo</option>
        <option>Rohomutagatifu</option>
        <option>Other More songs</option>
    </select>
    <button onclick="clearFilters()" id="resetBtn">Subira</button>
</div>

<!-- ===== SECTION NAVIGATION ===== -->
<nav id="sectionNav"></nav>

<!-- ===== SONGS CONTAINER ===== -->
<div id="sectionsContainer"></div>

<!-- ===== COMPACT BOTTOM SECTION - REDUCED SIZE, IMMEDIATELY VISIBLE ===== -->
<div class="bottom-admin-section">
    <div class="bottom-admin-container">
        <!-- Admin Login Card - Compact -->
        <div class="admin-card">
            <h3 id="adminCardTitle">üîê Admin</h3>
            <p id="adminCardDesc" style="margin-bottom:3px;">Injira nka admin</p>
            <button class="bottom-btn" onclick="window.location.href='admin.html'">
                <span>üîë</span> <span id="adminBtnText">Injira</span>
            </button>
        </div>
        
        <!-- Contact Us Card - Compact -->
        <div class="contact-card">
            <h3 id="contactCardTitle">üìû Twandikire</h3>
            <p id="contactCardDesc" style="margin-bottom:3px;">Ubutumwa</p>
            <button class="bottom-btn" onclick="showContactModal()">
                <span>‚úâÔ∏è</span> <span id="contactBtnText">Ohereza</span>
            </button>
            <div class="contact-info" id="contactInfoText">
                <span>üìß gaspardgasangwa76@gmail.com</span>
            </div>
        </div>

        <!-- User Upload Card - Compact -->
        <div class="user-upload-card">
            <h3 id="userUploadTitle">üéµ Shyiramo</h3>
            <p id="userUploadDesc" style="margin-bottom:3px;">Indirimbo yawe</p>
            <button class="bottom-btn" onclick="showUserUploadModal()">
                <span>üì§</span> <span id="userUploadBtnText">Shyiramo</span>
            </button>
            <div class="contact-info" id="userUploadHint" style="font-size:11px;">
                <span>‚è±Ô∏è Igice cya missa</span>
            </div>
        </div>
    </div>
</div>

<!-- ===== CONTACT MODAL ===== -->
<div id="contactModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Twandikire</h3>
        <input type="email" id="contactEmail" placeholder="Imeyili yawe">
        <textarea id="contactMessage" placeholder="Andika ubutumwa"></textarea>
        <button class="send-btn" onclick="sendMessage()" id="sendBtn">Ohereza</button>
        <button class="close-btn" onclick="closeContactModal()" id="closeBtn">Funga</button>
    </div>
</div>

<!-- ===== USER UPLOAD MODAL ===== -->
<div id="userUploadModal" class="modal">
    <div class="modal-content">
        <h3 id="userUploadModalTitle">üì§ Shyiraho indirimbo</h3>
        <p id="userUploadModalDesc" style="color:#666; margin-bottom:15px;">Uzuza, ihite igaragara!</p>
        
        <input type="text" id="userSongTitle" placeholder="Izina ry'indirimbo">
        
        <select id="userSongSection">
            <option value="">-- Hitamo igice cya missa --</option>
            <option>Gutangira</option>
            <option>Nyagasani Tubabarire</option>
            <option>Imana nisingizwe mu ijuru</option>
            <option>Zaburi</option>
            <option>Alleluya</option>
            <option>Indanga kwemera</option>
            <option>Ibisabisho</option>
            <option>Gutura</option>
            <option>Nyirubutagatifu</option>
            <option>Ntama w'Imana</option>
            <option>Gusangira</option>
            <option>Gushimira</option>
            <option>Gusoza</option>
            <option>Bikiramariya</option>
            <option>Abatagatifu bose</option>
            <option>Gushyingirwa</option>
            <option>Ibitaramo</option>
            <option>Adiventi</option>
            <option>Noheli</option>
            <option>Igisibo</option>
            <option>Pasika</option>
            <option>Asensiyo</option>
            <option>Rohomutagatifu</option>
            <option>Other More songs</option>
        </select>

        <input type="file" id="userSongFile" accept=".mp3,.pdf,.jpg,.jpeg,.png">

        <input type="email" id="userEmail" placeholder="Imeyili yawe">

        <textarea id="userComments" placeholder="Igitekerezo (byaba biri)" rows="2"></textarea>

        <div style="margin-top:20px;">
            <button class="send-btn" onclick="submitUserSong()" id="submitSongBtn">Ohereza</button>
            <button class="close-btn" onclick="closeUserUploadModal()" id="cancelUploadBtn">Gusiba</button>
        </div>
    </div>
</div>

<!-- ===== FILE PREVIEW MODAL ===== -->
<div id="previewModal" class="modal">
    <div class="modal-content" style="max-width: 750px;">
        <h3 id="previewTitle">üîç Reba indirimbo</h3>
        <div id="previewContainer" style="text-align: center; min-height: 180px;">
            <!-- Preview will be loaded here -->
        </div>
        <button class="close-btn" onclick="closePreviewModal()" style="margin-top:20px;" id="closePreviewBtn">Funga</button>
    </div>
</div>

<!-- ===== PWA NOTIFICATION ===== -->
<div id="pwaNotification" class="pwa-notification" style="display:none; position:fixed; bottom:20px; right:20px; background:#4b0082; color:white; padding:12px 20px; border-radius:10px; z-index:10000;">
    <span id="pwaMessage"></span>
    <button onclick="hidePWANotification()" style="margin-left:12px; padding:4px 12px; background:white; color:#4b0082; border:none; border-radius:5px;">OK</button>
</div>

<script>
    // ========== 4-LANGUAGE TRANSLATIONS ==========
    const translations = {
        rw: {
            appTitle: "INDIRIMBO ZA GATOLIKA",
            songCount: "SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA",
            searchPlaceholder: "Shaka indirimbo ku izina...",
            filterPlaceholder: "-- Shaka ukurikije igice --",
            reset: "Subira",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Injira nka admin",
            adminBtnText: "Injira",
            contactCardTitle: "üìû Twandikire",
            contactCardDesc: "Ubutumwa",
            contactBtnText: "Ohereza",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Twandikire",
            emailPlaceholder: "Imeyili yawe",
            messagePlaceholder: "Andika ubutumwa",
            send: "Ohereza",
            close: "Funga",
            messageSent: "Ubutumwa bwawe bwoherejwe! Murakoze.",
            userUploadTitle: "üéµ Shyiramo",
            userUploadDesc: "Indirimbo yawe",
            userUploadBtnText: "Shyiramo",
            userUploadHint: "‚è±Ô∏è Igice cya missa",
            userModalTitle: "üì§ Shyiraho indirimbo",
            userModalDesc: "Uzuza, ihite igaragara!",
            songTitlePlaceholder: "Izina ry'indirimbo",
            sectionPlaceholder: "-- Hitamo igice cya missa --",
            emailPlaceholder2: "Imeyili yawe",
            commentsPlaceholder: "Igitekerezo (byaba biri)",
            submitBtn: "Ohereza",
            cancelBtn: "Gusiba",
            submitSuccess: "Indirimbo yawe yashyizweho! Igaragara noneho.",
            fileRequired: "Hitamo fayilo!",
            titleRequired: "Andika izina ry'indirimbo!",
            sectionRequired: "Hitamo igice!",
            emailRequired: "Andika imeyili yawe!",
            previewTitle: "üîç Reba indirimbo",
            closePreview: "Funga",
            adminNotification: "üîî Hari user ukoze upload!",
            download: "Download",
            preview: "Reba"
        },
        fr: {
            appTitle: "CHANTS CATHOLIQUES",
            songCount: "RECHERCHER UN CHANT PAR NOM OU SECTION",
            searchPlaceholder: "Rechercher...",
            filterPlaceholder: "-- Filtrer par section --",
            reset: "R√©initialiser",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Connexion",
            adminBtnText: "Connexion",
            contactCardTitle: "üìû Contact",
            contactCardDesc: "Message",
            contactBtnText: "Envoyer",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Contactez-nous",
            emailPlaceholder: "Votre email",
            messagePlaceholder: "Votre message",
            send: "Envoyer",
            close: "Fermer",
            messageSent: "Message envoy√©! Merci.",
            userUploadTitle: "üéµ Ajouter",
            userUploadDesc: "Votre chant",
            userUploadBtnText: "Ajouter",
            userUploadHint: "‚è±Ô∏è Section messe",
            userModalTitle: "üì§ Ajouter un chant",
            userModalDesc: "Visible imm√©diatement!",
            songTitlePlaceholder: "Titre",
            sectionPlaceholder: "-- Choisissez la section --",
            emailPlaceholder2: "Votre email",
            commentsPlaceholder: "Commentaire",
            submitBtn: "Soumettre",
            cancelBtn: "Annuler",
            submitSuccess: "Chant ajout√©! Visible maintenant.",
            fileRequired: "Choisissez un fichier!",
            titleRequired: "Entrez le titre!",
            sectionRequired: "Choisissez la section!",
            emailRequired: "Entrez votre email!",
            previewTitle: "üîç Aper√ßu",
            closePreview: "Fermer",
            adminNotification: "üîî Un utilisateur a ajout√©!",
            download: "T√©l√©charger",
            preview: "Aper√ßu"
        },
        sw: {
            appTitle: "NYIMBO ZA KIKATOLIKI",
            songCount: "TAFUTA WIMBO KWA JINA AU SEHEMU",
            searchPlaceholder: "Tafuta...",
            filterPlaceholder: "-- Chuja kwa sehemu --",
            reset: "Weka upya",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Ingia",
            adminBtnText: "Ingia",
            contactCardTitle: "üìû Wasiliana",
            contactCardDesc: "Ujumbe",
            contactBtnText: "Tuma",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Wasiliana",
            emailPlaceholder: "Barua pepe yako",
            messagePlaceholder: "Ujumbe wako",
            send: "Tuma",
            close: "Funga",
            messageSent: "Ujumbe umetumwa! Asante.",
            userUploadTitle: "üéµ Pakia",
            userUploadDesc: "Wimbo wako",
            userUploadBtnText: "Pakia",
            userUploadHint: "‚è±Ô∏è Sehemu ya misa",
            userModalTitle: "üì§ Pakia wimbo",
            userModalDesc: "Inaonekana mara moja!",
            songTitlePlaceholder: "Jina la wimbo",
            sectionPlaceholder: "-- Chagua sehemu --",
            emailPlaceholder2: "Barua pepe yako",
            commentsPlaceholder: "Maoni",
            submitBtn: "Wasilisha",
            cancelBtn: "Ghairi",
            submitSuccess: "Wimbo umepakiwa! Unaonekana sasa.",
            fileRequired: "Chagua faili!",
            titleRequired: "Andika jina!",
            sectionRequired: "Chagua sehemu!",
            emailRequired: "Andika barua pepe!",
            previewTitle: "üîç Hakiki",
            closePreview: "Funga",
            adminNotification: "üîî Mtumiaji amepakia!",
            download: "Pakua",
            preview: "Hakiki"
        },
        en: {
            appTitle: "CATHOLIC HYMNS",
            songCount: "SEARCH HYMNS BY NAME OR MASS SECTION",
            searchPlaceholder: "Search hymns...",
            filterPlaceholder: "-- Filter by section --",
            reset: "Reset",
            adminCardTitle: "üîê Admin",
            adminCardDesc: "Admin login",
            adminBtnText: "Login",
            contactCardTitle: "üìû Contact",
            contactCardDesc: "Send message",
            contactBtnText: "Send",
            contactInfo: "üìß gaspardgasangwa76@gmail.com",
            modalTitle: "Contact Us",
            emailPlaceholder: "Your email",
            messagePlaceholder: "Your message",
            send: "Send",
            close: "Close",
            messageSent: "Message sent! Thank you.",
            userUploadTitle: "üéµ Upload",
            userUploadDesc: "Your hymn",
            userUploadBtnText: "Upload",
            userUploadHint: "‚è±Ô∏è Mass section",
            userModalTitle: "üì§ Upload Hymn",
            userModalDesc: "Appears instantly!",
            songTitlePlaceholder: "Hymn title",
            sectionPlaceholder: "-- Select Mass section --",
            emailPlaceholder2: "Your email",
            commentsPlaceholder: "Comments",
            submitBtn: "Submit",
            cancelBtn: "Cancel",
            submitSuccess: "Your hymn is uploaded! Visible now.",
            fileRequired: "Select a file!",
            titleRequired: "Enter title!",
            sectionRequired: "Select section!",
            emailRequired: "Enter your email!",
            previewTitle: "üîç Preview",
            closePreview: "Close",
            adminNotification: "üîî A user uploaded!",
            download: "Download",
            preview: "Preview"
        }
    };

    // ========== GLOBAL VARIABLES ==========
    let currentLang = localStorage.getItem('preferredLang') || 'rw';
    let allSongs = [];

    // ========== LANGUAGE SETTER ==========
    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('preferredLang', lang);
        applyTranslations();
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === lang);
        });
    }

    // ========== APPLY TRANSLATIONS ==========
    function applyTranslations() {
        const t = translations[currentLang];
        document.getElementById('appTitle').innerText = t.appTitle;
        document.getElementById('songCount').innerHTML = t.songCount + (navigator.onLine ? '' : ' (Offline)');
        document.getElementById('searchInput').placeholder = t.searchPlaceholder;
        if (document.getElementById('sectionFilter')) {
            document.getElementById('sectionFilter').options[0].text = t.filterPlaceholder;
        }
        document.getElementById('resetBtn').innerText = t.reset;
        document.getElementById('adminCardTitle').innerHTML = t.adminCardTitle;
        document.getElementById('adminCardDesc').innerText = t.adminCardDesc;
        document.getElementById('adminBtnText').innerText = t.adminBtnText;
        document.getElementById('contactCardTitle').innerHTML = t.contactCardTitle;
        document.getElementById('contactCardDesc').innerText = t.contactCardDesc;
        document.getElementById('contactBtnText').innerText = t.contactBtnText;
        document.getElementById('contactInfoText').innerHTML = t.contactInfo;
        document.getElementById('modalTitle').innerText = t.modalTitle;
        document.getElementById('contactEmail').placeholder = t.emailPlaceholder;
        document.getElementById('contactMessage').placeholder = t.messagePlaceholder;
        document.getElementById('sendBtn').innerText = t.send;
        document.getElementById('closeBtn').innerText = t.close;
        document.getElementById('userUploadTitle').innerHTML = t.userUploadTitle;
        document.getElementById('userUploadDesc').innerText = t.userUploadDesc;
        document.getElementById('userUploadBtnText').innerText = t.userUploadBtnText;
        document.getElementById('userUploadHint').innerHTML = `<span>${t.userUploadHint}</span>`;
        document.getElementById('userUploadModalTitle').innerText = t.userModalTitle;
        document.getElementById('userUploadModalDesc').innerText = t.userModalDesc;
        document.getElementById('userSongTitle').placeholder = t.songTitlePlaceholder;
        if (document.getElementById('userSongSection')) {
            document.getElementById('userSongSection').options[0].text = t.sectionPlaceholder;
        }
        document.getElementById('userEmail').placeholder = t.emailPlaceholder2;
        document.getElementById('userComments').placeholder = t.commentsPlaceholder;
        document.getElementById('submitSongBtn').innerText = t.submitBtn;
        document.getElementById('cancelUploadBtn').innerText = t.cancelBtn;
        document.getElementById('previewTitle').innerText = t.previewTitle;
        document.getElementById('closePreviewBtn').innerText = t.closePreview;
        document.getElementById('notificationMessage').innerText = t.adminNotification;
    }

    // ========== LOAD SONGS FROM LOCALSTORAGE ==========
    function loadSongs() {
        allSongs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
        displayAllSongs();
        updateSongCount();
    }

    // ========== DISPLAY SONGS ==========
    function displayAllSongs() {
        const container = document.getElementById('sectionsContainer');
        if (!container) return;
        
        if (allSongs.length === 0) {
            container.innerHTML = `<div class="section active"><h2>Indirimbo</h2><div class="no-songs"><p>Nta ndirimbo zishyizweho.</p><p>Shyiramo bwa mbere ukoresheje buto yo hepfo!</p></div></div>`;
            return;
        }
        
        // Group by section
        const sections = {};
        allSongs.forEach(song => {
            if (!sections[song.section]) sections[song.section] = [];
            sections[song.section].push(song);
        });
        
        let html = '';
        for (const [sectionName, sectionSongs] of Object.entries(sections)) {
            html += `<div class="section" id="section-${sectionName.replace(/\s+/g, '-')}">`;
            html += `<h2>${sectionName} (${sectionSongs.length})</h2>`;
            html += `<div class="songs-list">`;
            
            sectionSongs.forEach(song => {
                html += `<div class="song" id="song-${song.id}">`;
                html += `<div class="song-header">`;
                html += `<h3 class="song-title">${song.title}</h3>`;
                html += `<span class="song-date">${song.dateAdded || 'Vuba'}</span>`;
                html += `</div>`;
                html += `<div class="song-meta">`;
                html += `<span class="song-section">${song.section}</span>`;
                html += `<span class="song-size">${song.fileSize || ''}</span>`;
                html += `<span class="download-count">üîΩ ${song.downloadCount || 0}</span>`;
                if (song.uploadedBy === 'user') {
                    html += `<span style="background: #ffc107; color: #000; padding: 3px 10px; border-radius: 12px; font-size: 12px;">üë§ User</span>`;
                }
                html += `</div>`;
                html += `<div class="song-actions">`;
                html += `<button class="preview-btn" onclick="previewFile('${song.id}')"><span>üëÅÔ∏è</span> ${translations[currentLang].preview || 'Reba'}</button>`;
                html += `<button class="download-btn" onclick="downloadSong('${song.id}')"><span>‚¨áÔ∏è</span> ${translations[currentLang].download || 'Download'}</button>`;
                html += `</div>`;
                html += `</div>`;
            });
            
            html += `</div></div>`;
        }
        container.innerHTML = html;
        
        // Show first section
        if (Object.keys(sections).length > 0) {
            showSection(Object.keys(sections)[0]);
        }
    }

    // ========== CREATE SECTION NAVIGATION ==========
    function createNavigation() {
        const sections = [
            'Gutangira', 'Nyagasani Tubabarire', 'Imana nisingizwe mu ijuru',
            'Zaburi', 'Alleluya', 'Indanga kwemera', 'Ibisabisho', 'Gutura',
            'Nyirubutagatifu', 'Ntama w\'Imana', 'Gusangira', 'Gushimira',
            'Gusoza', 'Bikiramariya', 'Abatagatifu bose', 'Gushyingirwa',
            'Ibitaramo', 'Adiventi', 'Noheli', 'Igisibo', 'Pasika', 'Asensiyo',
            'Rohomutagatifu', 'Other More songs'
        ];
        const nav = document.getElementById('sectionNav');
        if (!nav) return;
        nav.innerHTML = '';
        sections.forEach(section => {
            const btn = document.createElement('button');
            btn.textContent = section;
            btn.onclick = () => showSection(section);
            nav.appendChild(btn);
        });
    }

    function showSection(sectionName) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        const section = document.getElementById(`section-${sectionName.replace(/\s+/g, '-')}`);
        if (section) section.classList.add('active');
    }

    // ========== PREVIEW FILE IN BROWSER - FIXED ==========
    window.previewFile = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        if (!song) {
            alert("Indirimbo ntabwo iboneka!");
            return;
        }
        
        const previewContainer = document.getElementById('previewContainer');
        const t = translations[currentLang];
        
        let previewHtml = '';
        
        // Check file type and create appropriate preview
        const fileExt = song.fileName ? song.fileName.split('.').pop().toLowerCase() : '';
        const fileType = song.fileType ? song.fileType.toLowerCase() : fileExt;
        
        if (fileType === 'mp3' || fileExt === 'mp3') {
            previewHtml = `<audio controls style="width:100%; margin-top:20px;">
                <source src="${song.fileUrl}" type="audio/mpeg">
                Your browser does not support audio.
            </audio>`;
        } else if (fileType === 'pdf' || fileExt === 'pdf') {
            previewHtml = `<iframe src="${song.fileUrl}" class="preview-iframe" title="PDF Preview"></iframe>`;
        } else if (['jpg', 'jpeg', 'png', 'gif'].includes(fileType) || ['jpg', 'jpeg', 'png', 'gif'].includes(fileExt)) {
            previewHtml = `<img src="${song.fileUrl}" style="max-width:100%; max-height:400px; border-radius:10px;" alt="Preview">`;
        } else {
            previewHtml = `<p style="padding: 30px; background: #f8f9fa; border-radius: 10px;">
                ${song.fileName || 'Fayilo'} - Ntago ushobora kureba muri browser. 
                <br>Kanda <strong>Download</strong>.
            </p>`;
        }
        
        previewContainer.innerHTML = `<h4 style="margin-bottom:12px; color:#4b0082;">${song.title}</h4>${previewHtml}`;
        document.getElementById('previewModal').style.display = 'flex';
    };

    window.closePreviewModal = function() {
        document.getElementById('previewModal').style.display = 'none';
        document.getElementById('previewContainer').innerHTML = '';
    };

    // ========== DOWNLOAD SONG - FIXED ==========
    window.downloadSong = function(songId) {
        const song = allSongs.find(s => s.id === songId);
        if (!song) {
            alert("Indirimbo ntabwo iboneka!");
            return;
        }
        
        // Increment download count
        song.downloadCount = (song.downloadCount || 0) + 1;
        localStorage.setItem('catholicSongs', JSON.stringify(allSongs));
        
        // Create download link
        const a = document.createElement('a');
        a.href = song.fileUrl;
        a.download = song.fileName || `${song.title}.mp3`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        // Update UI
        displayAllSongs();
    };

    // ========== USER SUBMIT SONG - FIXED ==========
    window.submitUserSong = function() {
        const t = translations[currentLang];
        const title = document.getElementById('userSongTitle').value.trim();
        const section = document.getElementById('userSongSection').value;
        const file = document.getElementById('userSongFile').files[0];
        const email = document.getElementById('userEmail').value.trim();
        
        if (!title) { alert(t.titleRequired); return; }
        if (!section) { alert(t.sectionRequired); return; }
        if (!file) { alert(t.fileRequired); return; }
        if (!email) { alert(t.emailRequired); return; }
        
        // Create song object - IMMEDIATELY VISIBLE
        const songId = 'user-song-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        const fileUrl = URL.createObjectURL(file);
        
        const newSong = {
            id: songId,
            title: title,
            section: section,
            fileUrl: fileUrl,
            fileName: file.name,
            fileType: file.name.split('.').pop().toLowerCase(),
            fileSize: (file.size / 1024).toFixed(2) + ' KB',
            dateAdded: new Date().toLocaleDateString('rw-RW'),
            downloadCount: 0,
            uploadedBy: 'user',
            uploaderEmail: email,
            comments: document.getElementById('userComments').value,
            submittedAt: new Date().toISOString()
        };
        
        // Add to allSongs and localStorage
        allSongs.push(newSong);
        localStorage.setItem('catholicSongs', JSON.stringify(allSongs));
        
        // 1. NOTIFY ADMIN - show notification badge
        document.getElementById('adminNotification').style.display = 'flex';
        setTimeout(() => {
            document.getElementById('adminNotification').style.display = 'none';
        }, 6000);
        
        // 2. Store in admin notifications
        const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
        notifications.push({
            type: 'user_upload',
            message: `User ${email} uploaded "${title}" in ${section}`,
            time: new Date().toISOString(),
            songId: songId
        });
        localStorage.setItem('adminNotifications', JSON.stringify(notifications));
        
        // 3. Save submission for admin dashboard
        const submissions = JSON.parse(localStorage.getItem('userSongSubmissions') || '[]');
        submissions.push({
            ...newSong,
            status: 'approved',
            reviewed: false
        });
        localStorage.setItem('userSongSubmissions', JSON.stringify(submissions));
        
        // Success message and close modal
        alert(t.submitSuccess);
        closeUserUploadModal();
        
        // Refresh display to show new song in its section
        displayAllSongs();
        
        // Switch to the section where song was added
        showSection(section);
    };

    // ========== MODAL CONTROLS ==========
    window.showContactModal = function() {
        document.getElementById('contactModal').style.display = 'flex';
    };
    window.closeContactModal = function() {
        document.getElementById('contactModal').style.display = 'none';
        document.getElementById('contactEmail').value = '';
        document.getElementById('contactMessage').value = '';
    };
    window.sendMessage = function() {
        const email = document.getElementById('contactEmail').value.trim();
        const message = document.getElementById('contactMessage').value.trim();
        if (!email || !message) { 
            alert(translations[currentLang].emailPlaceholder || 'Andika imeyili n'ubutumwa'); 
            return; 
        }
        const msgs = JSON.parse(localStorage.getItem('contactMessages') || '[]');
        msgs.push({ email, message, time: new Date().toLocaleString() });
        localStorage.setItem('contactMessages', JSON.stringify(msgs));
        alert(translations[currentLang].messageSent);
        closeContactModal();
    };

    window.showUserUploadModal = function() {
        document.getElementById('userUploadModal').style.display = 'flex';
    };
    window.closeUserUploadModal = function() {
        document.getElementById('userUploadModal').style.display = 'none';
        document.getElementById('userSongTitle').value = '';
        document.getElementById('userSongSection').value = '';
        document.getElementById('userSongFile').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('userComments').value = '';
    };

    // ========== SEARCH & FILTER ==========
    window.searchSongs = function() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        if (!term) { displayAllSongs(); return; }
        const filtered = allSongs.filter(s => 
            s.title.toLowerCase().includes(term) || 
            s.section.toLowerCase().includes(term)
        );
        displayFiltered(filtered);
    };

    window.filterBySection = function() {
        const section = document.getElementById('sectionFilter').value;
        if (!section) { displayAllSongs(); return; }
        const filtered = allSongs.filter(s => s.section === section);
        displayFiltered(filtered);
    };

    function displayFiltered(songs) {
        const container = document.getElementById('sectionsContainer');
        if (songs.length === 0) {
            container.innerHTML = `<div class="section active"><h2>Indirimbo</h2><div class="no-songs"><p>Nta ndirimbo zihuye</p></div></div>`;
            return;
        }
        let html = `<div class="section active"><h2>Ubushakashatsi (${songs.length})</h2><div class="songs-list">`;
        songs.forEach(song => {
            html += `<div class="song">
                <div class="song-header"><h3 class="song-title">${song.title}</h3></div>
                <div class="song-meta">
                    <span>${song.section}</span>
                    <span>${song.fileSize || ''}</span>
                    <span>üîΩ ${song.downloadCount || 0}</span>
                </div>
                <div class="song-actions">
                    <button class="preview-btn" onclick="previewFile('${song.id}')">üëÅÔ∏è ${translations[currentLang].preview || 'Reba'}</button>
                    <button class="download-btn" onclick="downloadSong('${song.id}')">‚¨áÔ∏è ${translations[currentLang].download || 'Download'}</button>
                </div>
            </div>`;
        });
        html += `</div></div>`;
        container.innerHTML = html;
    }

    window.clearFilters = function() {
        document.getElementById('searchInput').value = '';
        document.getElementById('sectionFilter').value = '';
        displayAllSongs();
    };

    // ========== UTILITIES ==========
    function updateSongCount() {
        const el = document.getElementById('songCount');
        if (el) {
            let text = `${translations[currentLang].songCount} | Indirimbo: ${allSongs.length}`;
            if (!navigator.onLine) text += ' (Offline)';
            el.innerHTML = text;
        }
    }
    
    window.hidePWANotification = function() {
        document.getElementById('pwaNotification').style.display = 'none';
    };

    // ========== INITIALIZATION ==========
    window.onload = function() {
        // Load songs from localStorage
        loadSongs();
        createNavigation();
        applyTranslations();
        
        // Set active language button
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === currentLang);
        });
        
        // Check for existing admin notifications
        const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
        if (notifications.length > 0) {
            const lastNotif = notifications[notifications.length - 1];
            const timeDiff = Date.now() - new Date(lastNotif.time).getTime();
            if (timeDiff < 3600000) {
                document.getElementById('adminNotification').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('adminNotification').style.display = 'none';
                }, 5000);
            }
        }
    };
</script>
</body>
</html>
