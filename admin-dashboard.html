<!DOCTYPE html>
<html lang="rw">
<head>
    <link rel="icon" type="image/png" href="logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard ¬∑ INDIRIMBO ZA GATOLIKA</title>
    <!-- 4 LANGUAGES: Kinyarwanda, French, Kiswahili, English -->
    <style>
        /* ===== ORIGINAL DASHBOARD STYLES - FULLY PRESERVED AND FIXED ===== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
        }
        .admin-header {
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        .admin-header h2 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .admin-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .admin-actions button {
            padding: 12px 25px;
            background: #4b0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .admin-actions button:hover {
            background: #5a0d9c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .admin-actions button.logout {
            background: #6c757d;
        }
        .admin-actions button.logout:hover {
            background: #5a6268;
        }
        
        /* ===== LANGUAGE SWITCHER ===== */
        .lang-switch-dash {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 6px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            z-index: 200;
        }
        .lang-switch-dash .lang-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .lang-switch-dash .lang-btn.active {
            background: white;
            color: #4b0082;
            border-color: white;
        }
        
        /* ===== TABS ===== */
        .admin-tabs {
            display: flex;
            background: linear-gradient(135deg, #6a5acd, #9370db);
            margin: 0;
            border-radius: 0;
            overflow: hidden;
        }
        .tab-btn {
            flex: 1;
            padding: 18px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        .tab-btn.active {
            background: #4b0082;
            border-bottom: 3px solid white;
        }
        
        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            background: white;
            margin: 0;
            padding: 30px;
            min-height: 500px;
            animation: fadeIn 0.5s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== UPLOAD TAB ===== */
        .upload-info {
            background: #e8f4fd;
            border-left: 4px solid #4b0082;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .upload-options {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .upload-option {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .upload-option:hover {
            border-color: #4b0082;
            background: #f8f9fa;
        }
        .upload-option.active {
            border-color: #4b0082;
            background: #f0e6ff;
        }
        .upload-form-group {
            margin: 20px 0;
        }
        .upload-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4b0082;
        }
        .upload-form-group select,
        .upload-form-group input[type="file"] {
            width: 100%;
            max-width: 600px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        .upload-buttons {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .upload-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .upload-btn.primary {
            background: #4b0082;
            color: white;
        }
        .upload-btn.primary:hover:not(:disabled) {
            background: #5a0d9c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .upload-btn.secondary {
            background: #6c757d;
            color: white;
        }
        .upload-btn.secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        .upload-btn.danger {
            background: #dc3545;
            color: white;
        }
        .upload-btn.danger:hover {
            background: #c82333;
        }
        .upload-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ===== PROGRESS ===== */
        .progress-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4b0082;
            display: none;
        }
        .progress-container.show {
            display: block;
        }
        .progress-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4b0082, #6a5acd);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        /* ===== MANAGE SONGS ===== */
        .search-admin {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .search-admin input {
            flex: 2;
            min-width: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-admin select {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-admin button {
            padding: 15px 25px;
            background: #4b0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .search-admin button:hover {
            background: #5a0d9c;
        }
        
        /* ===== SONGS LIST ===== */
        .songs-list-admin {
            margin-top: 30px;
        }
        .admin-section {
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .admin-section h4 {
            color: #4b0082;
            margin-top: 0;
            padding-bottom: 20px;
            border-bottom: 3px solid #4b0082;
            font-size: 28px;
        }
        .count-badge {
            background: #4b0082;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .admin-song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            margin: 15px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 6px solid #4b0082;
            transition: all 0.3s;
        }
        .admin-song-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .song-info {
            flex: 1;
        }
        .song-info strong {
            color: #333;
            font-size: 22px;
            display: block;
            margin-bottom: 12px;
        }
        .song-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .song-details span {
            background: #e9ecef;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: #495057;
        }
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        .preview-btn {
            background: #17a2b8;
            color: white;
        }
        .preview-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        /* ===== STATUS TAB ===== */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stats-item {
            display: flex;
            justify-content: space-between;
            padding: 18px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 12px 0;
            border-left: 4px solid #4b0082;
        }
        .contact-log {
            margin-top: 30px;
            background: #f1f8ff;
            padding: 20px;
            border-radius: 15px;
        }
        .contact-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #4b0082;
        }
        
        /* ===== NOTIFICATION ===== */
        #notification {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4b0082;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            .admin-header h2 { font-size: 2em; }
            .admin-tabs { flex-direction: column; }
            .tab-btn { width: 100%; }
            .admin-song-item { flex-direction: column; align-items: flex-start; }
            .song-actions { margin-top: 15px; }
            .lang-switch-dash { position: static; margin-top: 15px; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h2 id="dashboardTitle">üìã Admin Dashboard</h2>
        <div class="lang-switch-dash" id="dashLangSwitch">
            <button class="lang-btn" data-lang="rw" onclick="setDashLang('rw')">Kinyarwanda</button>
            <button class="lang-btn" data-lang="fr" onclick="setDashLang('fr')">Fran√ßais</button>
            <button class="lang-btn" data-lang="sw" onclick="setDashLang('sw')">Kiswahili</button>
            <button class="lang-btn" data-lang="en" onclick="setDashLang('en')">English</button>
        </div>
        <div class="admin-actions">
            <button onclick="refreshDashboard()" id="refreshBtn"><span>üîÑ</span> <span class="refreshText">Refresh</span></button>
            <button onclick="checkUserView()" id="userViewBtn"><span>üëÅÔ∏è</span> <span class="userViewText">Reba User View</span></button>
            <button class="logout" onclick="logout()" id="logoutBtn"><span>üö™</span> <span class="logoutText">Sohoka</span></button>
        </div>
    </div>

    <div class="admin-tabs">
        <button class="tab-btn active" onclick="showTab('upload')" id="tabUploadBtn">üì§ Shyiraho</button>
        <button class="tab-btn" onclick="showTab('manage')" id="tabManageBtn">üìã Menya</button>
        <button class="tab-btn" onclick="showTab('status')" id="tabStatusBtn">üìä Status</button>
    </div>

    <!-- ===== UPLOAD TAB ===== -->
    <div id="uploadTab" class="tab-content active">
        <div class="upload-info" id="uploadInfo">
            <h3 style="color:#4b0082; margin-top:0" id="uploadInfoTitle">Shyiraho Indirimbo</h3>
            <p id="uploadInfoDesc"><strong>Amabwiriza:</strong> Hitamo uburyo, fayilo n'igice.</p>
        </div>
        <div class="upload-options">
            <div class="upload-option active" onclick="selectUploadMode('single')" id="optSingle">
                <div class="upload-option-icon">üìÑ</div>
                <h4 id="singleTitle">Indirimbo Imwe</h4>
                <p id="singleDesc">Shyiramo indirimbo imwe</p>
            </div>
            <div class="upload-option" onclick="selectUploadMode('multiple')" id="optMulti">
                <div class="upload-option-icon">üìö</div>
                <h4 id="multiTitle">Indirimbo Nyinshi</h4>
                <p id="multiDesc">Shyiramo nyinshi icyarimwe</p>
            </div>
            <div class="upload-option" onclick="selectUploadMode('large')" id="optLarge">
                <div class="upload-option-icon">üíæ</div>
                <h4 id="largeTitle">Fayilo Nini</h4>
                <p id="largeDesc">Shyiramo fayilo nini (MP3)</p>
            </div>
        </div>
        <div class="upload-form">
            <div class="upload-form-group">
                <label for="uploadSection" id="sectionLabel">üìÅ Hitamo Igice:</label>
                <select id="uploadSection">
                    <option value="">-- Hitamo igice --</option>
                    <option>Gutangira</option> <option>Nyagasani Tubabarire</option> <option>Imana nisingizwe mu ijuru</option>
                    <option>Zaburi</option> <option>Alleluya</option> <option>Indanga kwemera</option> <option>Ibisabisho</option>
                    <option>Gutura</option> <option>Nyirubutagatifu</option> <option>Ntama w'Imana</option> <option>Gusangira</option>
                    <option>Gushimira</option> <option>Gusoza</option> <option>Bikiramariya</option> <option>Abatagatifu bose</option>
                    <option>Gushyingirwa</option> <option>Ibitaramo</option> <option>Adiventi</option> <option>Noheli</option>
                    <option>Igisibo</option> <option>Pasika</option> <option>Asensiyo</option> <option>Rohomutagatifu</option>
                    <option>Other More songs</option>
                </select>
            </div>
            <div class="upload-form-group">
                <label for="uploadFile" id="fileLabel">üìÑ Hitamo Fayilo:</label>
                <input type="file" id="uploadFile" accept=".pdf,.jpg,.jpeg,.png,.gif,.mp3">
            </div>
            <div id="uploadStatusMessage" class="status-message" style="color:#721c24; background:#f8d7da; padding:12px; border-radius:8px; margin:10px 0; display:none;"></div>
            <div class="upload-buttons">
                <button id="uploadButton" class="upload-btn primary" onclick="startUpload()" disabled><span>üì§</span> <span id="uploadBtnText">Shyiraho Indirimbo</span></button>
                <button class="upload-btn secondary" onclick="resetUploadForm()"><span>üîÑ</span> <span id="resetBtnText">Subira utangire</span></button>
                <button id="cancelUploadButton" class="upload-btn danger" style="display:none;" onclick="cancelUpload()"><span>‚èπÔ∏è</span> <span id="cancelBtnText">Hagarika</span></button>
            </div>
            <div id="progressContainer" class="progress-container">
                <div class="progress-label"><span id="progressLabel">Iri kushyirwa:</span> <span id="progressPercent">0%</span></div>
                <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width:0%"></div></div>
            </div>
        </div>
    </div>

    <!-- ===== MANAGE SONGS TAB ===== -->
    <div id="manageTab" class="tab-content">
        <div class="search-admin">
            <input type="text" id="searchInput" placeholder="Shaka indirimbo..." oninput="searchSongs()">
            <select id="filterSection" onchange="filterSongs()">
                <option value="">-- Hitamo igice --</option>
                <option>Gutangira</option> <option>Nyagasani Tubabarire</option> <option>Imana nisingizwe mu ijuru</option>
                <option>Zaburi</option> <option>Alleluya</option> <option>Indanga kwemera</option> <option>Ibisabisho</option>
                <option>Gutura</option> <option>Nyirubutagatifu</option> <option>Ntama w'Imana</option> <option>Gusangira</option>
                <option>Gushimira</option> <option>Gusoza</option> <option>Bikiramariya</option> <option>Abatagatifu bose</option>
                <option>Gushyingirwa</option> <option>Ibitaramo</option> <option>Adiventi</option> <option>Noheli</option>
                <option>Igisibo</option> <option>Pasika</option> <option>Asensiyo</option> <option>Rohomutagatifu</option>
                <option>Other More songs</option>
            </select>
            <button onclick="clearFilters()" id="clearFilterBtn">Subira</button>
        </div>
        <div style="margin:20px 0; padding:15px; background:#f8f9fa; border-radius:8px;">
            <strong>Indirimbo zishyizweho:</strong> <span id="totalSongsCount">0</span>
        </div>
        <div id="songsList" class="songs-list-admin"></div>
    </div>

    <!-- ===== STATUS TAB ===== -->
    <div id="statusTab" class="tab-content">
        <div class="reports-grid">
            <div class="report-card">
                <h4 id="statsSysTitle">üìä Ibyerekeye Sisitemu</h4>
                <div class="stats-item"><span id="statsTotalSongsLabel">Indirimbo zishyizweho:</span> <strong id="statusTotalSongs">0</strong></div>
                <div class="stats-item"><span id="statsTotalDownloadsLabel">Downloads zose:</span> <strong id="statusTotalDownloads">0</strong></div>
            </div>
            <div class="report-card">
                <h4 id="statsAdminTitle">üë§ Ibikorwa byawe</h4>
                <div class="stats-item"><span id="statsMySongsLabel">Washyizemo:</span> <strong id="statusMySongs">0</strong></div>
                <div class="stats-item"><span id="statsAdminNameLabel">Uyobowe:</span> <strong id="statusAdminName">Admin</strong></div>
            </div>
        </div>
        <div class="contact-log" id="contactLogSection">
            <h4 style="color:#17a2b8;" id="contactLogTitle">‚úâÔ∏è Ubutumwa bwatanzwe na users (Twandikire)</h4>
            <div id="contactMessagesList" style="max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="notification"></div>

    <script>
        // ========== 4-LANGUAGE TRANSLATIONS FOR DASHBOARD ==========
        const dashLangStrings = {
            rw: {
                title: "üìã Admin Dashboard",
                refresh: "Ongera urebe",
                userView: "Reba User View",
                logout: "Sohoka",
                tabUpload: "üì§ Shyiraho",
                tabManage: "üìã Menya",
                tabStatus: "üìä Status",
                uploadInfoTitle: "Shyiraho Indirimbo",
                uploadInfoDesc: "<strong>Amabwiriza:</strong> Hitamo uburyo, fayilo n'igice.",
                singleTitle: "Indirimbo Imwe",
                singleDesc: "Shyiramo indirimbo imwe",
                multiTitle: "Indirimbo Nyinshi",
                multiDesc: "Shyiramo nyinshi icyarimwe",
                largeTitle: "Fayilo Nini",
                largeDesc: "Shyiramo fayilo nini (MP3)",
                sectionLabel: "üìÅ Hitamo Igice:",
                fileLabel: "üìÑ Hitamo Fayilo:",
                uploadBtn: "Shyiraho Indirimbo",
                resetBtn: "Subira utangire",
                cancelBtn: "Hagarika",
                searchPlaceholder: "Shaka indirimbo...",
                clearFilter: "Subira",
                statsSys: "üìä Ibyerekeye Sisitemu",
                statsTotalSongs: "Indirimbo zishyizweho:",
                statsTotalDownloads: "Downloads zose:",
                statsAdmin: "üë§ Ibikorwa byawe",
                statsMySongs: "Washyizemo:",
                statsAdminName: "Uyobowe:",
                contactTitle: "‚úâÔ∏è Ubutumwa bwatanzwe na users",
                noMessages: "Nta ubutumwa",
                deleteConfirm: "Urashaka gusiba iyi ndirimbo?",
                deleteSuccess: "Indirimbo yasibwe!",
                uploadSuccess: "Indirimbo yashyizweho neza!"
            },
            en: {
                title: "üìã Admin Dashboard",
                refresh: "Refresh",
                userView: "User View",
                logout: "Logout",
                tabUpload: "üì§ Upload",
                tabManage: "üìã Manage",
                tabStatus: "üìä Status",
                uploadInfoTitle: "Upload Songs",
                uploadInfoDesc: "<strong>Instructions:</strong> Choose mode, file and section.",
                singleTitle: "Single Song",
                singleDesc: "Upload one song",
                multiTitle: "Multiple Songs",
                multiDesc: "Upload multiple songs",
                largeTitle: "Large File",
                largeDesc: "Upload large file (MP3)",
                sectionLabel: "üìÅ Select Section:",
                fileLabel: "üìÑ Choose File:",
                uploadBtn: "Upload Song",
                resetBtn: "Reset",
                cancelBtn: "Cancel",
                searchPlaceholder: "Search songs...",
                clearFilter: "Reset",
                statsSys: "üìä System Stats",
                statsTotalSongs: "Total songs:",
                statsTotalDownloads: "Total downloads:",
                statsAdmin: "üë§ Your activity",
                statsMySongs: "Uploaded by you:",
                statsAdminName: "Admin:",
                contactTitle: "‚úâÔ∏è User messages",
                noMessages: "No messages",
                deleteConfirm: "Are you sure you want to delete this song?",
                deleteSuccess: "Song deleted!",
                uploadSuccess: "Song uploaded successfully!"
            }
        };

        let dashLang = localStorage.getItem('dashLang') || 'rw';
        let allSongs = [];
        let currentUploadMode = 'single';
        let isUploadInProgress = false;
        let currentUploadCancel = false;
        let uploadInterval = null;

        // ========== LANGUAGE ==========
        function setDashLang(lang) {
            dashLang = lang;
            localStorage.setItem('dashLang', lang);
            applyDashTranslations();
        }

        function applyDashTranslations() {
            const t = dashLangStrings[dashLang];
            document.getElementById('dashboardTitle').innerText = t.title;
            document.querySelector('.refreshText').innerText = t.refresh;
            document.querySelector('.userViewText').innerText = t.userView;
            document.querySelector('.logoutText').innerText = t.logout;
            document.getElementById('tabUploadBtn').innerHTML = `üì§ ${t.tabUpload}`;
            document.getElementById('tabManageBtn').innerHTML = `üìã ${t.tabManage}`;
            document.getElementById('tabStatusBtn').innerHTML = `üìä ${t.tabStatus}`;
            document.getElementById('uploadInfoTitle').innerText = t.uploadInfoTitle;
            document.getElementById('uploadInfoDesc').innerHTML = t.uploadInfoDesc;
            document.getElementById('singleTitle').innerText = t.singleTitle;
            document.getElementById('singleDesc').innerText = t.singleDesc;
            document.getElementById('multiTitle').innerText = t.multiTitle;
            document.getElementById('multiDesc').innerText = t.multiDesc;
            document.getElementById('largeTitle').innerText = t.largeTitle;
            document.getElementById('largeDesc').innerText = t.largeDesc;
            document.getElementById('sectionLabel').innerHTML = t.sectionLabel;
            document.getElementById('fileLabel').innerHTML = t.fileLabel;
            document.getElementById('uploadBtnText').innerText = t.uploadBtn;
            document.getElementById('resetBtnText').innerText = t.resetBtn;
            document.getElementById('cancelBtnText').innerText = t.cancelBtn;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            document.getElementById('clearFilterBtn').innerText = t.clearFilter;
            document.getElementById('statsSysTitle').innerHTML = t.statsSys;
            document.getElementById('statsTotalSongsLabel').innerText = t.statsTotalSongs;
            document.getElementById('statsTotalDownloadsLabel').innerText = t.statsTotalDownloads;
            document.getElementById('statsAdminTitle').innerHTML = t.statsAdmin;
            document.getElementById('statsMySongsLabel').innerText = t.statsMySongs;
            document.getElementById('statsAdminNameLabel').innerText = t.statsAdminName;
            document.getElementById('contactLogTitle').innerHTML = t.contactTitle;
            
            document.querySelectorAll('.lang-switch-dash .lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === dashLang);
            });
            displayContactMessages();
        }

        // ========== INIT ==========
        function initDashboard() {
            if (!localStorage.getItem('isAdmin')) {
                window.location.href = "admin.html";
                return;
            }
            loadSongs();
            updateStatus();
            populateSectionFilter();
            applyDashTranslations();
            displayContactMessages();
            setupUploadListeners();
        }

        // ========== UPLOAD LISTENERS ==========
        function setupUploadListeners() {
            document.getElementById('uploadFile').addEventListener('change', updateUploadButton);
            document.getElementById('uploadSection').addEventListener('change', updateUploadButton);
        }

        function selectUploadMode(mode) {
            currentUploadMode = mode;
            document.querySelectorAll('.upload-option').forEach(opt => opt.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const fileInput = document.getElementById('uploadFile');
            if (mode === 'multiple') {
                fileInput.setAttribute('multiple', 'multiple');
            } else {
                fileInput.removeAttribute('multiple');
            }
            updateUploadButton();
        }

        function updateUploadButton() {
            const fileInput = document.getElementById('uploadFile');
            const section = document.getElementById('uploadSection').value;
            const uploadBtn = document.getElementById('uploadButton');
            uploadBtn.disabled = !(fileInput.files.length > 0 && section);
        }

        function showStatusMessage(msg, isError = false) {
            const el = document.getElementById('uploadStatusMessage');
            el.style.display = 'block';
            el.style.background = isError ? '#f8d7da' : '#d4edda';
            el.style.color = isError ? '#721c24' : '#155724';
            el.innerText = msg;
            setTimeout(() => { el.style.display = 'none'; }, 3000);
        }

        // ========== UPLOAD ==========
        window.startUpload = function() {
            if (isUploadInProgress) {
                showStatusMessage("Harimo gushyirwa... Tegereza!", true);
                return;
            }
            
            const fileInput = document.getElementById('uploadFile');
            const section = document.getElementById('uploadSection').value;
            
            if (!fileInput.files.length) {
                showStatusMessage("Hitamo fayilo!", true);
                return;
            }
            if (!section) {
                showStatusMessage("Hitamo igice!", true);
                return;
            }

            const files = Array.from(fileInput.files);
            if (currentUploadMode === 'multiple' && files.length > 1) {
                startBatchUpload(files, section);
            } else {
                uploadSingleFile(files[0], section);
            }
        };

        function uploadSingleFile(file, section) {
            isUploadInProgress = true;
            currentUploadCancel = false;
            
            document.getElementById('progressContainer').classList.add('show');
            document.getElementById('cancelUploadButton').style.display = 'inline-flex';
            document.getElementById('uploadButton').disabled = true;

            const title = file.name.replace(/\.[^/.]+$/, '').replace(/[_-]/g, ' ').trim();
            const songId = 'song-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            const fileType = file.name.split('.').pop().toLowerCase();
            const adminUser = localStorage.getItem('adminUser') || 'admin';

            const newSong = {
                id: songId,
                title: title,
                section: section,
                fileUrl: URL.createObjectURL(file),
                fileName: file.name,
                fileType: fileType,
                fileSize: (file.size / 1024).toFixed(2) + ' KB',
                dateAdded: new Date().toLocaleDateString('rw-RW'),
                downloadCount: 0,
                uploadedBy: adminUser
            };

            let progress = 0;
            uploadInterval = setInterval(() => {
                if (currentUploadCancel) {
                    clearInterval(uploadInterval);
                    finishUpload(false);
                    return;
                }
                progress += 5;
                if (progress <= 100) {
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressPercent').innerText = progress + '%';
                }
                if (progress >= 100) {
                    clearInterval(uploadInterval);
                    
                    const songs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
                    songs.push(newSong);
                    localStorage.setItem('catholicSongs', JSON.stringify(songs));
                    
                    finishUpload(true);
                    showStatusMessage(dashLangStrings[dashLang].uploadSuccess);
                }
            }, 50);
        }

        function startBatchUpload(files, section) {
            isUploadInProgress = true;
            currentUploadCancel = false;
            
            document.getElementById('progressContainer').classList.add('show');
            document.getElementById('cancelUploadButton').style.display = 'inline-flex';
            document.getElementById('uploadButton').disabled = true;

            let completed = 0;
            const total = files.length;
            
            files.forEach((file, index) => {
                setTimeout(() => {
                    if (currentUploadCancel) return;
                    
                    const title = file.name.replace(/\.[^/.]+$/, '').replace(/[_-]/g, ' ').trim();
                    const songId = 'song-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9) + '-' + index;
                    
                    const newSong = {
                        id: songId,
                        title: title,
                        section: section,
                        fileUrl: URL.createObjectURL(file),
                        fileName: file.name,
                        fileType: file.name.split('.').pop().toLowerCase(),
                        fileSize: (file.size / 1024).toFixed(2) + ' KB',
                        dateAdded: new Date().toLocaleDateString('rw-RW'),
                        downloadCount: 0,
                        uploadedBy: localStorage.getItem('adminUser') || 'admin'
                    };
                    
                    const songs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
                    songs.push(newSong);
                    localStorage.setItem('catholicSongs', JSON.stringify(songs));
                    
                    completed++;
                    const progress = Math.round((completed / total) * 100);
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressPercent').innerText = progress + '%';
                    
                    if (completed === total) {
                        finishUpload(true);
                        showStatusMessage(`${total} indirimbo zashyizweho!`);
                    }
                }, index * 100);
            });
        }

        function finishUpload(success) {
            isUploadInProgress = false;
            clearInterval(uploadInterval);
            document.getElementById('progressContainer').classList.remove('show');
            document.getElementById('cancelUploadButton').style.display = 'none';
            document.getElementById('uploadButton').disabled = false;
            
            if (success) {
                loadSongs();
                updateStatus();
                resetUploadForm();
            }
        }

        window.cancelUpload = function() {
            currentUploadCancel = true;
            clearInterval(uploadInterval);
            finishUpload(false);
            showStatusMessage("Gushyiraho byahagaritswe!", true);
        };

        window.resetUploadForm = function() {
            document.getElementById('uploadFile').value = '';
            document.getElementById('uploadSection').value = '';
            document.getElementById('progressContainer').classList.remove('show');
            document.getElementById('cancelUploadButton').style.display = 'none';
            document.getElementById('uploadButton').disabled = true;
            document.getElementById('uploadStatusMessage').style.display = 'none';
        };

        // ========== MANAGE SONGS ==========
        function loadSongs() {
            allSongs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
            document.getElementById('totalSongsCount').innerText = allSongs.length;
            displaySongs();
        }

        function displaySongs() {
            const container = document.getElementById('songsList');
            if (allSongs.length === 0) {
                container.innerHTML = '<div class="no-songs" style="padding:60px; text-align:center;">Nta ndirimbo zishyizweho.</div>';
                return;
            }

            const sections = {};
            allSongs.forEach(song => {
                if (!sections[song.section]) sections[song.section] = [];
                sections[song.section].push(song);
            });

            let html = '';
            for (const [section, songs] of Object.entries(sections)) {
                html += `<div class="admin-section"><h4>${section} <span class="count-badge">${songs.length}</span></h4>`;
                songs.forEach(song => {
                    html += `<div class="admin-song-item" id="song-${song.id}">
                        <div class="song-info">
                            <strong>${song.title}</strong>
                            <div class="song-details">
                                <span>${song.fileType}</span>
                                <span>${song.section}</span>
                                <span>${song.dateAdded}</span>
                                <span>${song.fileSize}</span>
                                <span>üîΩ ${song.downloadCount || 0}</span>
                            </div>
                        </div>
                        <div class="song-actions">
                            <button class="action-btn preview-btn" onclick="previewSong('${song.id}')"><span>üëÅÔ∏è</span> Reba</button>
                            <button class="action-btn delete-btn" onclick="deleteSong('${song.id}')"><span>üóëÔ∏è</span> Sibya</button>
                        </div>
                    </div>`;
                });
                html += '</div>';
            }
            container.innerHTML = html;
        }

        window.previewSong = function(songId) {
            const song = allSongs.find(s => s.id === songId);
            if (song && song.fileUrl) {
                window.open(song.fileUrl, '_blank');
            }
        };

        window.deleteSong = function(songId) {
            if (!confirm(dashLangStrings[dashLang].deleteConfirm)) return;
            
            allSongs = allSongs.filter(s => s.id !== songId);
            localStorage.setItem('catholicSongs', JSON.stringify(allSongs));
            loadSongs();
            updateStatus();
            showNotification(dashLangStrings[dashLang].deleteSuccess);
        };

        window.searchSongs = function() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            if (!term) { displaySongs(); return; }
            
            const filtered = allSongs.filter(s => 
                s.title.toLowerCase().includes(term) || 
                s.section.toLowerCase().includes(term)
            );
            
            const container = document.getElementById('songsList');
            let html = '<div class="admin-section"><h4>Ubushakashatsi</h4>';
            filtered.forEach(song => {
                html += `<div class="admin-song-item">
                    <div class="song-info"><strong>${song.title}</strong>
                        <div class="song-details"><span>${song.section}</span><span>üîΩ ${song.downloadCount || 0}</span></div>
                    </div>
                    <div class="song-actions">
                        <button class="action-btn preview-btn" onclick="previewSong('${song.id}')">üëÅÔ∏è Reba</button>
                        <button class="action-btn delete-btn" onclick="deleteSong('${song.id}')">üóëÔ∏è Sibya</button>
                    </div>
                </div>`;
            });
            html += '</div>';
            container.innerHTML = html;
        };

        window.filterSongs = function() {
            const section = document.getElementById('filterSection').value;
            if (!section) { displaySongs(); return; }
            
            const filtered = allSongs.filter(s => s.section === section);
            const container = document.getElementById('songsList');
            let html = `<div class="admin-section"><h4>${section}</h4>`;
            filtered.forEach(song => {
                html += `<div class="admin-song-item">
                    <div class="song-info"><strong>${song.title}</strong>
                        <div class="song-details"><span>üîΩ ${song.downloadCount || 0}</span></div>
                    </div>
                    <div class="song-actions">
                        <button class="action-btn preview-btn" onclick="previewSong('${song.id}')">üëÅÔ∏è Reba</button>
                        <button class="action-btn delete-btn" onclick="deleteSong('${song.id}')">üóëÔ∏è Sibya</button>
                    </div>
                </div>`;
            });
            html += '</div>';
            container.innerHTML = html;
        };

        window.clearFilters = function() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterSection').value = '';
            displaySongs();
        };

        function populateSectionFilter() {
            const select = document.getElementById('filterSection');
            const sections = ['Gutangira','Nyagasani Tubabarire','Imana nisingizwe mu ijuru','Zaburi','Alleluya','Indanga kwemera','Ibisabisho','Gutura','Nyirubutagatifu','Ntama w\'Imana','Gusangira','Gushimira','Gusoza','Bikiramariya','Abatagatifu bose','Gushyingirwa','Ibitaramo','Adiventi','Noheli','Igisibo','Pasika','Asensiyo','Rohomutagatifu','Other More songs'];
            sections.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                select.appendChild(opt);
            });
        }

        // ========== STATUS ==========
        function updateStatus() {
            const adminUser = localStorage.getItem('adminUser') || 'admin';
            document.getElementById('statusTotalSongs').innerText = allSongs.length;
            document.getElementById('statusMySongs').innerText = allSongs.filter(s => s.uploadedBy === adminUser).length;
            document.getElementById('statusAdminName').innerText = adminUser;
            
            const totalDownloads = allSongs.reduce((sum, s) => sum + (s.downloadCount || 0), 0);
            document.getElementById('statusTotalDownloads').innerText = totalDownloads;
        }

        function displayContactMessages() {
            const msgs = JSON.parse(localStorage.getItem('contactMessages') || '[]');
            const container = document.getElementById('contactMessagesList');
            if (msgs.length === 0) {
                container.innerHTML = `<p style="color:#666;">${dashLangStrings[dashLang].noMessages}</p>`;
                return;
            }
            let html = '';
            msgs.slice(-10).reverse().forEach(msg => {
                html += `<div class="contact-item">
                    <strong>${msg.email}</strong><br>
                    ${msg.message}<br>
                    <small style="color:#666;">${msg.time}</small>
                </div>`;
            });
            container.innerHTML = html;
        }

        // ========== UTILITIES ==========
        function showNotification(msg) {
            const notif = document.getElementById('notification');
            notif.innerText = msg;
            notif.style.display = 'block';
            setTimeout(() => notif.style.display = 'none', 3000);
        }

        window.refreshDashboard = function() {
            loadSongs();
            updateStatus();
            displayContactMessages();
            showNotification("‚úÖ Byongeye kuvugururwa!");
        };

        window.checkUserView = function() {
            window.open('index.html', '_blank');
        };

        window.logout = function() {
            localStorage.removeItem('isAdmin');
            window.location.href = 'admin.html';
        };

        window.showTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tabName === 'manage') loadSongs();
            if (tabName === 'status') { updateStatus(); displayContactMessages(); }
        };

        // ========== INIT ==========
        window.onload = function() {
            if (localStorage.getItem('isAdmin') === 'true') {
                initDashboard();
            } else {
                window.location.href = "admin.html";
            }
        };
    </script>
</body>
</html>
